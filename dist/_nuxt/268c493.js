/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{339:function(e,t,n){"use strict";var r=n(3),o=n(6),c=n(71),h=n(229),l=n(227),d=n(5),f=RangeError,m=String,y=Math.floor,v=o(l),w=o("".slice),_=o(1..toFixed),T=function(e,t,n){return 0===t?n:t%2==1?T(e,t-1,n*e):T(e*e,t/2,n)},E=function(data,e,t){for(var n=-1,r=t;++n<6;)r+=e*data[n],data[n]=r%1e7,r=y(r/1e7)},I=function(data,e){for(var t=6,n=0;--t>=0;)n+=data[t],data[t]=y(n/e),n=n%e*1e7},S=function(data){for(var e=6,s="";--e>=0;)if(""!==s||0===e||0!==data[e]){var t=m(data[e]);s=""===s?t:s+v("0",7-t.length)+t}return s};r({target:"Number",proto:!0,forced:d((function(){return"0.000"!==_(8e-5,3)||"1"!==_(.9,0)||"1.25"!==_(1.255,2)||"1000000000000000128"!==_(0xde0b6b3a7640080,0)}))||!d((function(){_({})}))},{toFixed:function(e){var t,n,r,o,l=h(this),d=c(e),data=[0,0,0,0,0,0],y="",_="0";if(d<0||d>20)throw new f("Incorrect fraction digits");if(l!=l)return"NaN";if(l<=-1e21||l>=1e21)return m(l);if(l<0&&(y="-",l=-l),l>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(l*T(2,69,1))-69)<0?l*T(2,-t,1):l/T(2,t,1),n*=4503599627370496,(t=52-t)>0){for(E(data,0,n),r=d;r>=7;)E(data,1e7,0),r-=7;for(E(data,T(10,r,1),0),r=t-1;r>=23;)I(data,1<<23),r-=23;I(data,1<<r),E(data,1,1),I(data,2),_=S(data)}else E(data,0,n),E(data,1<<-t,0),_=S(data)+v("0",d);return _=d>0?y+((o=_.length)<=d?"0."+v("0",d-o)+_:w(_,0,o-d)+"."+w(_,o-d)):y+_}})},352:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return no})),n.d(t,"b",(function(){return ro})),n.d(t,"c",(function(){return ko})),n.d(t,"d",(function(){return oo}));var r=n(31),o=n(51),c=n(52),h=n(2),l=n(362);const d="@firebase/firestore";class f{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}f.UNAUTHENTICATED=new f(null),f.GOOGLE_CREDENTIALS=new f("google-credentials-uid"),f.FIRST_PARTY=new f("first-party-uid"),f.MOCK_USER=new f("mock-user");let m="10.10.0";const b=new c.b("@firebase/firestore");function y(){return b.logLevel}function v(e,...t){if(b.logLevel<=c.a.DEBUG){const n=t.map(T);b.debug(`Firestore (${m}): ${e}`,...n)}}function w(e,...t){if(b.logLevel<=c.a.ERROR){const n=t.map(T);b.error(`Firestore (${m}): ${e}`,...n)}}function _(e,...t){if(b.logLevel<=c.a.WARN){const n=t.map(T);b.warn(`Firestore (${m}): ${e}`,...n)}}function T(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function E(e="Unexpected state"){const t=`FIRESTORE (${m}) INTERNAL ASSERTION FAILED: `+e;throw w(t),new Error(t)}function I(e,t){e||E()}function S(e,t){return e}const C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class k extends h.c{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class A{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class N{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class R{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(f.UNAUTHENTICATED)))}shutdown(){}}class O{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class D{constructor(e){this.t=e,this.currentUser=f.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let o=new A;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new A,e.enqueueRetryable((()=>r(this.currentUser)))};const c=()=>{const t=o;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},h=e=>{v("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),c()};this.t.onInit((e=>h(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?h(e):(v("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new A)}}),0),c()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(v("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(I("string"==typeof t.accessToken),new N(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return I(null===e||"string"==typeof e),new f(e)}}class P{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=f.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class L{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new P(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(f.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class x{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class M{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=e=>{null!=e.error&&v("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,v("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{v("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):v("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(I("string"==typeof e.token),this.R=e.token,new x(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function U(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class V{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const r=U(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%62))}return n}}function F(e,t){return e<t?-1:e>t?1:0}function j(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}class B{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new k(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new k(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new k(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new k(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return B.fromMillis(Date.now())}static fromDate(e){return B.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new B(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?F(this.nanoseconds,e.nanoseconds):F(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class K{constructor(e){this.timestamp=e}static fromTimestamp(e){return new K(e)}static min(){return new K(new B(0,0))}static max(){return new K(new B(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class z{constructor(e,t,n){void 0===t?t=0:t>e.length&&E(),void 0===n?n=e.length-t:n>e.length-t&&E(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===z.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof z?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class $ extends z{construct(e,t,n){return new $(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new k(C.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new $(t)}static emptyPath(){return new $([])}}const G=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class H extends z{construct(e,t,n){return new H(e,t,n)}static isValidIdentifier(e){return G.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),H.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new H(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const o=()=>{if(0===n.length)throw new k(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new k(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new k(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(i=!i,r++):"."!==t||i?(n+=t,r++):(o(),r++)}if(o(),i)throw new k(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new H(t)}static emptyPath(){return new H([])}}class W{constructor(e){this.path=e}static fromPath(e){return new W($.fromString(e))}static fromName(e){return new W($.fromString(e).popFirst(5))}static empty(){return new W($.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===$.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return $.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new W(new $(e.slice()))}}class Q{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}Q.UNKNOWN_ID=-1;function J(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=K.fromTimestamp(1e9===r?new B(n+1,0):new B(n,r));return new Y(i,W.empty(),t)}function X(e){return new Y(e.readTime,e.key,-1)}class Y{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Y(K.min(),W.empty(),-1)}static max(){return new Y(K.max(),W.empty(),-1)}}function Z(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=W.comparator(e.documentKey,t.documentKey),0!==n?n:F(e.largestBatchId,t.largestBatchId))}const ee="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class te{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function ne(e){if(e.code!==C.FAILED_PRECONDITION||e.message!==ee)throw e;v("LocalStore","Unexpectedly lost primary lease")}class re{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&E(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new re(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof re?t:re.resolve(t)}catch(e){return re.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):re.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):re.reject(t)}static resolve(e){return new re(((t,n)=>{t(e)}))}static reject(e){return new re(((t,n)=>{n(e)}))}static waitFor(e){return new re(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=re.resolve(!1);for(const n of e)t=t.next((e=>e?re.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new re(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let c=0;c<i;c++){const a=c;t(e[a]).next((e=>{s[a]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new re(((n,r)=>{const o=()=>{!0===e()?t().next((()=>{o()}),r):n()};o()}))}}class ie{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new A,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new ae(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{const n=de(t.target.error);this.V.reject(new ae(e,n))}}static open(e,t,n,r){try{return new ie(t,e.transaction(r,n))}catch(e){throw new ae(t,e)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(v("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new ue(t)}}class se{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===se.S(Object(h.o)())&&w("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return v("SimpleDb","Removing database:",e),he(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Object(h.t)())return!1;if(se.C())return!0;const e=Object(h.o)(),t=se.S(e),n=0<t&&t<10,r=se.v(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static C(){var t;return void 0!==e&&"YES"===(null===(t=e.__PRIVATE_env)||void 0===t?void 0:t.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(e){return this.db||(v("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new ae(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new k(C.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new k(C.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new ae(e,r))},r.onupgradeneeded=e=>{v("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.p.N(t,r.transaction,e.oldVersion,this.version).next((()=>{v("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.L&&(this.db.onversionchange=e=>this.L(e)),this.db}B(e){this.L=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.O(e);const t=ie.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.g(),e))).catch((e=>(t.abort(e),re.reject(e)))).toPromise();return s.catch((()=>{})),await t.m,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(v("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class oe{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return he(this.k.delete())}}class ae extends k{constructor(e,t){super(C.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ce(e){return"IndexedDbTransactionError"===e.name}class ue{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(v("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(v("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),he(n)}add(e){return v("SimpleDb","ADD",this.store.name,e,e),he(this.store.add(e))}get(e){return he(this.store.get(e)).next((t=>(void 0===t&&(t=null),v("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return v("SimpleDb","DELETE",this.store.name,e),he(this.store.delete(e))}count(){return v("SimpleDb","COUNT",this.store.name),he(this.store.count())}W(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new re(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}{const e=this.cursor(n),t=[];return this.G(e,((e,n)=>{t.push(n)})).next((()=>t))}}j(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new re(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}H(e,t){v("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.J=!1;const r=this.cursor(n);return this.G(r,((e,t,n)=>n.delete()))}Y(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.G(r,t)}Z(e){const t=this.cursor({});return new re(((n,r)=>{t.onerror=e=>{const t=de(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}G(e,t){const n=[];return new re(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new oe(i),o=t(i.primaryKey,i.value,s);if(o instanceof re){const e=o.catch((e=>(s.done(),re.reject(e))));n.push(e)}s.isDone?r():null===s.$?i.continue():i.continue(s.$)}})).next((()=>re.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.J?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function he(e){return new re(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=de(e.target.error);n(t)}}))}let le=!1;function de(e){const t=se.S(Object(h.o)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new k("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return le||(le=!0,setTimeout((()=>{throw e}),0)),e}}return e}class fe{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.se(e),this.oe=e=>t.writeSequenceNumber(e))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.oe&&this.oe(e),e}}function pe(e){return null==e}function ge(e){return 0===e&&1/e==-1/0}fe._e=-1;const me=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ye=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ve=ye;function we(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function _e(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Te(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Ee{constructor(e,t){this.comparator=e,this.root=t||be.EMPTY}insert(e,t){return new Ee(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,be.BLACK,null,null))}remove(e){return new Ee(this.comparator,this.root.remove(e,this.comparator).copy(null,null,be.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ie(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ie(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ie(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ie(this.root,e,this.comparator,!0)}}class Ie{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class be{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:be.RED,this.left=null!=r?r:be.EMPTY,this.right=null!=i?i:be.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new be(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return be.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return be.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,be.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,be.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw E();if(this.right.isRed())throw E();const e=this.left.check();if(e!==this.right.check())throw E();return e+(this.isRed()?0:1)}}be.EMPTY=null,be.RED=!0,be.BLACK=!1,be.EMPTY=new class{constructor(){this.size=0}get key(){throw E()}get value(){throw E()}get color(){throw E()}get left(){throw E()}get right(){throw E()}copy(e,t,n,r,i){return this}insert(e,t,n){return new be(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Se{constructor(e){this.comparator=e,this.data=new Ee(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ce(this.data.getIterator())}getIteratorFrom(e){return new Ce(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Se))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Se(this.comparator);return t.data=e,t}}class Ce{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ke{constructor(e){this.fields=e,e.sort(H.comparator)}static empty(){return new ke([])}unionWith(e){let t=new Se(H.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new ke(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return j(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Ae extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ne{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Ae("Invalid base64 string: "+e):e}}(e);return new Ne(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Ne(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return F(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ne.EMPTY_BYTE_STRING=new Ne("");const Re=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Oe(e){if(I(!!e),"string"==typeof e){let t=0;const n=Re.exec(e);if(I(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:De(e.seconds),nanos:De(e.nanos)}}function De(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Pe(e){return"string"==typeof e?Ne.fromBase64String(e):Ne.fromUint8Array(e)}function Le(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function xe(e){const t=e.mapValue.fields.__previous_value__;return Le(t)?xe(t):t}function Me(e){const t=Oe(e.mapValue.fields.__local_write_time__.timestampValue);return new B(t.seconds,t.nanos)}class Ue{constructor(e,t,n,r,i,s,o,c,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=c,this.useFetchStreams=a}}class Ve{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Ve("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Ve&&e.projectId===this.projectId&&e.database===this.database}}const Fe={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function je(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Le(e)?4:Ze(e)?9007199254740991:10:E()}function qe(e,t){if(e===t)return!0;const n=je(e);if(n!==je(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Me(e).isEqual(Me(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Oe(e.timestampValue),r=Oe(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Pe(e.bytesValue).isEqual(Pe(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return De(e.geoPointValue.latitude)===De(t.geoPointValue.latitude)&&De(e.geoPointValue.longitude)===De(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return De(e.integerValue)===De(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=De(e.doubleValue),r=De(t.doubleValue);return n===r?ge(n)===ge(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return j(e.arrayValue.values||[],t.arrayValue.values||[],qe);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(we(n)!==we(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!qe(n[e],r[e])))return!1;return!0}(e,t);default:return E()}}function Be(e,t){return void 0!==(e.values||[]).find((e=>qe(e,t)))}function Ke(e,t){if(e===t)return 0;const n=je(e),r=je(t);if(n!==r)return F(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return F(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=De(e.integerValue||e.doubleValue),r=De(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return ze(e.timestampValue,t.timestampValue);case 4:return ze(Me(e),Me(t));case 5:return F(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Pe(e),r=Pe(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=F(n[e],r[e]);if(0!==t)return t}return F(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=F(De(e.latitude),De(t.latitude));return 0!==n?n:F(De(e.longitude),De(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Ke(n[e],r[e]);if(t)return t}return F(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Fe.mapValue&&t===Fe.mapValue)return 0;if(e===Fe.mapValue)return 1;if(t===Fe.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=F(r[e],s[e]);if(0!==t)return t;const o=Ke(n[r[e]],i[s[e]]);if(0!==o)return o}return F(r.length,s.length)}(e.mapValue,t.mapValue);default:throw E()}}function ze(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return F(e,t);const n=Oe(e),r=Oe(t),i=F(n.seconds,r.seconds);return 0!==i?i:F(n.nanos,r.nanos)}function $e(e){return Ge(e)}function Ge(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Oe(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Pe(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return W.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Ge(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Ge(e.fields[i])}`;return n+"}"}(e.mapValue):E()}function He(e){return!!e&&"integerValue"in e}function We(e){return!!e&&"arrayValue"in e}function Qe(e){return!!e&&"nullValue"in e}function Je(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Xe(e){return!!e&&"mapValue"in e}function Ye(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return _e(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Ye(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Ye(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Ze(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class et{constructor(e){this.value=e}static empty(){return new et({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Xe(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ye(t)}setAll(e){let t=H.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Ye(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Xe(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return qe(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Xe(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){_e(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new et(Ye(this.value))}}class tt{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new tt(e,0,K.min(),K.min(),K.min(),et.empty(),0)}static newFoundDocument(e,t,n,r){return new tt(e,1,t,K.min(),n,r,0)}static newNoDocument(e,t){return new tt(e,2,t,K.min(),K.min(),et.empty(),0)}static newUnknownDocument(e,t){return new tt(e,3,t,K.min(),K.min(),et.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(K.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=et.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=et.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=K.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof tt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new tt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class nt{constructor(e,t){this.position=e,this.inclusive=t}}function it(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?W.comparator(W.fromName(o.referenceValue),n.key):Ke(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function st(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!qe(e.position[n],t.position[n]))return!1;return!0}class ot{constructor(e,t="asc"){this.field=e,this.dir=t}}function at(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class ct{}class ut extends ct{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new vt(e,t,n):"array-contains"===t?new Et(e,n):"in"===t?new It(e,n):"not-in"===t?new bt(e,n):"array-contains-any"===t?new St(e,n):new ut(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new wt(e,n):new _t(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ke(t,this.value)):null!==t&&je(this.value)===je(t)&&this.matchesComparison(Ke(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return E()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ht extends ct{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new ht(e,t)}matches(e){return lt(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function lt(e){return"and"===e.op}function ft(e){return pt(e)&&lt(e)}function pt(e){for(const t of e.filters)if(t instanceof ht)return!1;return!0}function gt(e){if(e instanceof ut)return e.field.canonicalString()+e.op.toString()+$e(e.value);if(ft(e))return e.filters.map((e=>gt(e))).join(",");{const t=e.filters.map((e=>gt(e))).join(",");return`${e.op}(${t})`}}function mt(e,t){return e instanceof ut?function(e,t){return t instanceof ut&&e.op===t.op&&e.field.isEqual(t.field)&&qe(e.value,t.value)}(e,t):e instanceof ht?function(e,t){return t instanceof ht&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&mt(n,t.filters[r])),!0)}(e,t):void E()}function yt(e){return e instanceof ut?function(e){return`${e.field.canonicalString()} ${e.op} ${$e(e.value)}`}(e):e instanceof ht?function(e){return e.op.toString()+" {"+e.getFilters().map(yt).join(" ,")+"}"}(e):"Filter"}class vt extends ut{constructor(e,t,n){super(e,t,n),this.key=W.fromName(n.referenceValue)}matches(e){const t=W.comparator(e.key,this.key);return this.matchesComparison(t)}}class wt extends ut{constructor(e,t){super(e,"in",t),this.keys=Tt("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class _t extends ut{constructor(e,t){super(e,"not-in",t),this.keys=Tt("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Tt(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>W.fromName(e.referenceValue)))}class Et extends ut{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return We(t)&&Be(t.arrayValue,this.value)}}class It extends ut{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Be(this.value.arrayValue,t)}}class bt extends ut{constructor(e,t){super(e,"not-in",t)}matches(e){if(Be(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Be(this.value.arrayValue,t)}}class St extends ut{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!We(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Be(this.value.arrayValue,e)))}}class Ct{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ce=null}}function kt(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Ct(e,t,n,r,i,s,o)}function At(e){const t=S(e);if(null===t.ce){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>gt(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),pe(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>$e(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>$e(e))).join(",")),t.ce=e}return t.ce}function Nt(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!at(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!mt(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!st(e.startAt,t.startAt)&&st(e.endAt,t.endAt)}function Rt(e){return W.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Ot{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=c,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function Dt(e,t,n,r,i,s,o,c){return new Ot(e,t,n,r,i,s,o,c)}function Pt(e){return new Ot(e)}function Lt(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function xt(e){return null!==e.collectionGroup}function Mt(e){const t=S(e);if(null===t.le){t.le=[];const e=new Set;for(const n of t.explicitOrderBy)t.le.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new Se(H.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.le.push(new ot(r,n))})),e.has(H.keyField().canonicalString())||t.le.push(new ot(H.keyField(),n))}return t.le}function Ut(e){const t=S(e);return t.he||(t.he=Vt(t,Mt(e))),t.he}function Vt(e,t){if("F"===e.limitType)return kt(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new ot(e.field,t)}));const n=e.endAt?new nt(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new nt(e.startAt.position,e.startAt.inclusive):null;return kt(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function Ft(e,t,n){return new Ot(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function jt(e,t){return Nt(Ut(e),Ut(t))&&e.limitType===t.limitType}function qt(e){return`${At(Ut(e))}|lt:${e.limitType}`}function Bt(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>yt(e))).join(", ")}]`),pe(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>$e(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>$e(e))).join(",")),`Target(${t})`}(Ut(e))}; limitType=${e.limitType})`}function Kt(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):W.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Mt(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=it(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Mt(e),t))&&!(e.endAt&&!function(e,t,n){const r=it(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Mt(e),t))}(e,t)}function zt(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function $t(e){return(t,n)=>{let r=!1;for(const i of Mt(e)){const e=Gt(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Gt(e,t,n){const r=e.field.isKeyField()?W.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Ke(r,i):E()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return E()}}class Ht{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){_e(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return Te(this.inner)}size(){return this.innerSize}}const Wt=new Ee(W.comparator);function Qt(){return Wt}const Jt=new Ee(W.comparator);function Xt(...e){let t=Jt;for(const n of e)t=t.insert(n.key,n);return t}function Yt(e){let t=Jt;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Zt(){return tn()}function en(){return tn()}function tn(){return new Ht((e=>e.toString()),((e,t)=>e.isEqual(t)))}new Ee(W.comparator);const nn=new Se(W.comparator);function rn(...e){let t=nn;for(const n of e)t=t.add(n);return t}const sn=new Se(F);function on(){return sn}function an(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ge(t)?"-0":t}}function cn(e){return{integerValue:""+e}}class un{constructor(){this._=void 0}}function hn(e,t,n){return e instanceof fn?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Le(t)&&(t=xe(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof pn?gn(e,t):e instanceof mn?yn(e,t):function(e,t){const n=dn(e,t),r=wn(n)+wn(e.Ie);return He(n)&&He(e.Ie)?cn(r):an(e.serializer,r)}(e,t)}function ln(e,t,n){return e instanceof pn?gn(e,t):e instanceof mn?yn(e,t):n}function dn(e,t){return e instanceof vn?function(e){return He(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class fn extends un{}class pn extends un{constructor(e){super(),this.elements=e}}function gn(e,t){const n=_n(t);for(const t of e.elements)n.some((e=>qe(e,t)))||n.push(t);return{arrayValue:{values:n}}}class mn extends un{constructor(e){super(),this.elements=e}}function yn(e,t){let n=_n(t);for(const t of e.elements)n=n.filter((e=>!qe(e,t)));return{arrayValue:{values:n}}}class vn extends un{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function wn(e){return De(e.integerValue||e.doubleValue)}function _n(e){return We(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Tn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Tn}static exists(e){return new Tn(void 0,e)}static updateTime(e){return new Tn(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function En(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class In{}function bn(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Pn(e.key,Tn.none()):new An(e.key,e.data,Tn.none());{const n=e.data,r=et.empty();let i=new Se(H.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Nn(e.key,r,new ke(i.toArray()),Tn.none())}}function Sn(e,t,n){e instanceof An?function(e,t,n){const r=e.value.clone(),i=On(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Nn?function(e,t,n){if(!En(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=On(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Rn(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Cn(e,t,n,r){return e instanceof An?function(e,t,n,r){if(!En(e.precondition,t))return n;const i=e.value.clone(),s=Dn(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Nn?function(e,t,n,r){if(!En(e.precondition,t))return n;const i=Dn(e.fieldTransforms,r,t),s=t.data;return s.setAll(Rn(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return En(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function kn(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&j(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof pn&&t instanceof pn||e instanceof mn&&t instanceof mn?j(e.elements,t.elements,qe):e instanceof vn&&t instanceof vn?qe(e.Ie,t.Ie):e instanceof fn&&t instanceof fn}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class An extends In{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Nn extends In{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Rn(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function On(e,t,n){const r=new Map;I(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,c=t.data.field(s.field);r.set(s.field,ln(o,c,n[i]))}return r}function Dn(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,hn(e,s,t))}return r}class Pn extends In{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ln{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Sn(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Cn(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Cn(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=en();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const c=bn(s,o);null!==c&&n.set(r.key,c),s.isValidDocument()||s.convertToNoDocument(K.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),rn())}isEqual(e){return this.batchId===e.batchId&&j(this.mutations,e.mutations,((e,t)=>kn(e,t)))&&j(this.baseMutations,e.baseMutations,((e,t)=>kn(e,t)))}}class xn{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Mn{constructor(e,t){this.count=e,this.unchangedNames=t}}var Un,Vn;function Fn(e){if(void 0===e)return w("GRPC error has no .code"),C.UNKNOWN;switch(e){case Un.OK:return C.OK;case Un.CANCELLED:return C.CANCELLED;case Un.UNKNOWN:return C.UNKNOWN;case Un.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case Un.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case Un.INTERNAL:return C.INTERNAL;case Un.UNAVAILABLE:return C.UNAVAILABLE;case Un.UNAUTHENTICATED:return C.UNAUTHENTICATED;case Un.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case Un.NOT_FOUND:return C.NOT_FOUND;case Un.ALREADY_EXISTS:return C.ALREADY_EXISTS;case Un.PERMISSION_DENIED:return C.PERMISSION_DENIED;case Un.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case Un.ABORTED:return C.ABORTED;case Un.OUT_OF_RANGE:return C.OUT_OF_RANGE;case Un.UNIMPLEMENTED:return C.UNIMPLEMENTED;case Un.DATA_LOSS:return C.DATA_LOSS;default:return E()}}(Vn=Un||(Un={}))[Vn.OK=0]="OK",Vn[Vn.CANCELLED=1]="CANCELLED",Vn[Vn.UNKNOWN=2]="UNKNOWN",Vn[Vn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Vn[Vn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Vn[Vn.NOT_FOUND=5]="NOT_FOUND",Vn[Vn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Vn[Vn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Vn[Vn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Vn[Vn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Vn[Vn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Vn[Vn.ABORTED=10]="ABORTED",Vn[Vn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Vn[Vn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Vn[Vn.INTERNAL=13]="INTERNAL",Vn[Vn.UNAVAILABLE=14]="UNAVAILABLE",Vn[Vn.DATA_LOSS=15]="DATA_LOSS";let jn=null;function qn(){return new TextEncoder}const Bn=new l.d([4294967295,4294967295],0);function Kn(e){const t=qn().encode(e),n=new l.e;return n.update(t),new Uint8Array(n.digest())}function zn(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new l.d([n,r],0),new l.d([i,s],0)]}class $n{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Gn(`Invalid padding: ${t}`);if(n<0)throw new Gn(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Gn(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Gn(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=l.d.fromNumber(this.Te)}de(e,t,n){let r=e.add(t.multiply(l.d.fromNumber(n)));return 1===r.compare(Bn)&&(r=new l.d([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=Kn(e),[n,r]=zn(t);for(let e=0;e<this.hashCount;e++){const t=this.de(n,r,e);if(!this.Ae(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new $n(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.Te)return;const t=Kn(e),[n,r]=zn(t);for(let e=0;e<this.hashCount;e++){const t=this.de(n,r,e);this.Re(t)}}Re(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Gn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Hn{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Wn.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Hn(K.min(),r,new Ee(F),Qt(),rn())}}class Wn{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Wn(n,t,rn(),rn(),rn())}}class Qn{constructor(e,t,n,r){this.Ve=e,this.removedTargetIds=t,this.key=n,this.me=r}}class Jn{constructor(e,t){this.targetId=e,this.fe=t}}class Xn{constructor(e,t,n=Ne.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Yn{constructor(){this.ge=0,this.pe=nr(),this.ye=Ne.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=rn(),t=rn(),n=rn();return this.pe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:E()}})),new Wn(this.ye,this.we,e,t,n)}Fe(){this.Se=!1,this.pe=nr()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,I(this.ge>=0)}Le(){this.Se=!0,this.we=!0}}class Zn{constructor(e){this.Be=e,this.ke=new Map,this.qe=Qt(),this.Qe=er(),this.Ke=new Ee(F)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,(t=>{const n=this.ze(t);switch(e.state){case 0:this.je(t)&&n.Ce(e.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(e.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(t);break;case 3:this.je(t)&&(n.Le(),n.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),n.Ce(e.resumeToken));break;default:E()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach(((e,n)=>{this.je(n)&&t(n)}))}Je(e){const t=e.targetId,n=e.fe.count,r=this.Ye(t);if(r){const i=r.target;if(Rt(i))if(0===n){const e=new W(i.path);this.We(t,e,tt.newNoDocument(e,K.min()))}else I(1===n);else{const r=this.Ze(t);if(r!==n){const n=this.Xe(e),i=n?this.et(n,e,r):1;if(0!==i){this.He(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,e)}null==jn||jn.tt(function(e,t,n,r,i){var s,o,c,a,u,h;const l={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},d=t.unchangedNames;return d&&(l.bloomFilter={applied:0===i,hashCount:null!==(s=null==d?void 0:d.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(a=null===(c=null===(o=null==d?void 0:d.bits)||void 0===o?void 0:o.bitmap)||void 0===c?void 0:c.length)&&void 0!==a?a:0,padding:null!==(h=null===(u=null==d?void 0:d.bits)||void 0===u?void 0:u.padding)&&void 0!==h?h:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),l}(r,e.fe,this.Be.nt(),n,i))}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=Pe(n).toUint8Array()}catch(e){if(e instanceof Ae)return _("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new $n(s,r,i)}catch(e){return _(e instanceof Gn?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.Te?null:o}et(e,t,n){return t.fe.count===n-this.rt(e,t.targetId)?0:2}rt(e,t){const n=this.Be.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.Be.nt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.We(t,n,null),r++)})),r}it(e){const t=new Map;this.ke.forEach(((n,r)=>{const i=this.Ye(r);if(i){if(n.current&&Rt(i.target)){const t=new W(i.target.path);null!==this.qe.get(t)||this.st(r,t)||this.We(r,t,tt.newNoDocument(t,e))}n.De&&(t.set(r,n.ve()),n.Fe())}}));let n=rn();this.Qe.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Ye(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.qe.forEach(((t,n)=>n.setReadTime(e)));const r=new Hn(e,t,this.Ke,this.qe,n);return this.qe=Qt(),this.Qe=er(),this.Ke=new Ee(F),r}Ue(e,t){if(!this.je(e))return;const n=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,n),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,n){if(!this.je(e))return;const r=this.ze(e);this.st(e,t)?r.Me(t,1):r.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),n&&(this.qe=this.qe.insert(t,n))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Be.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new Yn,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new Se(F),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||v("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Be._t(e)}He(e){this.ke.set(e,new Yn),this.Be.getRemoteKeysForTarget(e).forEach((t=>{this.We(e,t,null)}))}st(e,t){return this.Be.getRemoteKeysForTarget(e).has(t)}}function er(){return new Ee(W.comparator)}function nr(){return new Ee(W.comparator)}const rr={asc:"ASCENDING",desc:"DESCENDING"},ir={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},sr={and:"AND",or:"OR"};class or{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ar(e,t){return e.useProto3Json||pe(t)?t:{value:t}}function cr(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ur(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function lr(e){return I(!!e),K.fromTimestamp(function(e){const t=Oe(e);return new B(t.seconds,t.nanos)}(e))}function dr(e,t){return fr(e,t).canonicalString()}function fr(e,t){const n=function(e){return new $(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function pr(e){const t=$.fromString(e);return I(Or(t)),t}function gr(e,t){const n=pr(t);if(n.get(1)!==e.databaseId.projectId)throw new k(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new k(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new W(wr(n))}function mr(e,t){return dr(e.databaseId,t)}function yr(e){const t=pr(e);return 4===t.length?$.emptyPath():wr(t)}function vr(e){return new $(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function wr(e){return I(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function _r(e,t){return{documents:[mr(e,t.path)]}}function Tr(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=mr(e,i);const s=function(e){if(0!==e.length)return Rr(ht.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Ar(e.field),direction:Sr(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const c=ar(e,t.limit);return null!==c&&(n.structuredQuery.limit=c),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ut:n,parent:i}}function Er(e){let t=yr(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){I(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Ir(e);return t instanceof ht&&ft(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new ot(Nr(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let c=null;n.limit&&(c=function(e){let t;return t="object"==typeof e?e.value:e,pe(t)?null:t}(n.limit));let a=null;n.startAt&&(a=function(e){const t=!!e.before,n=e.values||[];return new nt(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new nt(n,t)}(n.endAt)),Dt(t,i,o,s,c,"F",a,u)}function Ir(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Nr(e.unaryFilter.field);return ut.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Nr(e.unaryFilter.field);return ut.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Nr(e.unaryFilter.field);return ut.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Nr(e.unaryFilter.field);return ut.create(i,"!=",{nullValue:"NULL_VALUE"});default:return E()}}(e):void 0!==e.fieldFilter?function(e){return ut.create(Nr(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return E()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return ht.create(e.compositeFilter.filters.map((e=>Ir(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return E()}}(e.compositeFilter.op))}(e):E()}function Sr(e){return rr[e]}function Cr(e){return ir[e]}function kr(e){return sr[e]}function Ar(e){return{fieldPath:e.canonicalString()}}function Nr(e){return H.fromServerFormat(e.fieldPath)}function Rr(e){return e instanceof ut?function(e){if("=="===e.op){if(Je(e.value))return{unaryFilter:{field:Ar(e.field),op:"IS_NAN"}};if(Qe(e.value))return{unaryFilter:{field:Ar(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Je(e.value))return{unaryFilter:{field:Ar(e.field),op:"IS_NOT_NAN"}};if(Qe(e.value))return{unaryFilter:{field:Ar(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ar(e.field),op:Cr(e.op),value:e.value}}}(e):e instanceof ht?function(e){const t=e.getFilters().map((e=>Rr(e)));return 1===t.length?t[0]:{compositeFilter:{op:kr(e.op),filters:t}}}(e):E()}function Or(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Dr{constructor(e,t,n,r,i=K.min(),s=K.min(),o=Ne.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=c}withSequenceNumber(e){return new Dr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Dr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Dr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Dr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Pr{constructor(e){this.ct=e}}function Lr(e){const t=Er({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Ft(t,t.limit,"L"):t}class xr{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(De(e.integerValue));else if("doubleValue"in e){const n=De(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),ge(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){const n=e.timestampValue;this.Et(t,20),"string"==typeof n?t.At(n):(t.At(`${n.seconds||""}`),t.dt(n.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(Pe(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?Ze(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):E()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const e of Object.keys(n))this.Rt(e,t),this.It(n[e],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const e of n)this.It(e,t)}gt(e,t){this.Et(t,37),W.fromName(e).path.forEach((e=>{this.Et(t,60),this.St(e,t)}))}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}xr.bt=new xr;class Mr{constructor(){this._n=new Ur}addToCollectionParentIndex(e,t){return this._n.add(t),re.resolve()}getCollectionParents(e,t){return re.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return re.resolve()}deleteFieldIndex(e,t){return re.resolve()}deleteAllFieldIndexes(e){return re.resolve()}createTargetIndexes(e,t){return re.resolve()}getDocumentsMatchingTarget(e,t){return re.resolve(null)}getIndexType(e,t){return re.resolve(0)}getFieldIndexes(e,t){return re.resolve([])}getNextCollectionGroupToUpdate(e){return re.resolve(null)}getMinOffset(e,t){return re.resolve(Y.min())}getMinOffsetFromCollectionGroup(e,t){return re.resolve(Y.min())}updateCollectionGroup(e,t,n){return re.resolve()}updateIndexEntries(e,t){return re.resolve()}}class Ur{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Se($.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Se($.comparator)).toArray()}}new Uint8Array(0);class Vr{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Vr(e,Vr.DEFAULT_COLLECTION_PERCENTILE,Vr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Vr.DEFAULT_COLLECTION_PERCENTILE=10,Vr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Vr.DEFAULT=new Vr(41943040,Vr.DEFAULT_COLLECTION_PERCENTILE,Vr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Vr.DISABLED=new Vr(-1,0,0);class Fr{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new Fr(0)}static Ln(){return new Fr(-1)}}class jr{constructor(){this.changes=new Ht((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,tt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?re.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class qr{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Br{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Cn(n.mutation,e,ke.empty(),B.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,rn()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=rn()){const r=Zt();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=Xt();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Zt();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,rn())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=Qt();const s=tn(),o=tn();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Nn)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Cn(o.mutation,t,o.mutation.getFieldMask(),B.now())):s.set(t.key,ke.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new qr(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=tn();let r=new Ee(((e,t)=>e-t)),i=rn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||ke.empty();o=i.applyToLocalView(s,o),n.set(e,o);const c=(r.get(i.batchId)||rn()).add(e);r=r.insert(i.batchId,c)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),c=r.key,a=r.value,u=en();a.forEach((e=>{if(!i.has(e)){const r=bn(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,c,u))}return re.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return W.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):xt(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):re.resolve(Zt());let o=-1,c=i;return s.next((t=>re.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?re.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{c=c.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,c,t,rn()))).next((e=>({batchId:o,changes:Yt(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new W(t)).next((e=>{let t=Xt();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=Xt();return this.indexManager.getCollectionParents(e,i).next((o=>re.forEach(o,(o=>{const c=function(e,t){return new Ot(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,n,r).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,tt.newInvalidDocument(r)))}));let n=Xt();return e.forEach(((e,r)=>{const s=i.get(e);void 0!==s&&Cn(s.mutation,r,ke.empty(),B.now()),Kt(t,r)&&(n=n.insert(e,r))})),n}))}}class Kr{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return re.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:lr(e.createTime)}}(t)),re.resolve()}getNamedQuery(e,t){return re.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(e){return{name:e.name,query:Lr(e.bundledQuery),readTime:lr(e.readTime)}}(t)),re.resolve()}}class zr{constructor(){this.overlays=new Ee(W.comparator),this.hr=new Map}getOverlay(e,t){return re.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Zt();return re.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ht(e,t,r)})),re.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.hr.delete(n)),re.resolve()}getOverlaysForCollection(e,t,n){const r=Zt(),i=t.length+1,s=new W(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return re.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new Ee(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Zt(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Zt(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return re.resolve(o)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new xn(t,n));let i=this.hr.get(t);void 0===i&&(i=rn(),this.hr.set(t,i)),this.hr.set(t,i.add(n.key))}}class $r{constructor(){this.Pr=new Se(Gr.Ir),this.Tr=new Se(Gr.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new Gr(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Ar(new Gr(e,t))}Rr(e,t){e.forEach((e=>this.removeReference(e,t)))}Vr(e){const t=new W(new $([])),n=new Gr(t,e),r=new Gr(t,e+1),i=[];return this.Tr.forEachInRange([n,r],(e=>{this.Ar(e),i.push(e.key)})),i}mr(){this.Pr.forEach((e=>this.Ar(e)))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new W(new $([])),n=new Gr(t,e),r=new Gr(t,e+1);let i=rn();return this.Tr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new Gr(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Gr{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return W.comparator(e.key,t.key)||F(e.pr,t.pr)}static Er(e,t){return F(e.pr,t.pr)||W.comparator(e.key,t.key)}}class Hr{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new Se(Gr.Ir)}checkEmpty(e){return re.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Ln(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.wr=this.wr.add(new Gr(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return re.resolve(s)}lookupMutationBatch(e,t){return re.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.br(n),i=r<0?0:r;return re.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return re.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return re.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Gr(t,0),r=new Gr(t,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,r],(e=>{const t=this.Sr(e.pr);i.push(t)})),re.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Se(F);return t.forEach((e=>{const t=new Gr(e,0),r=new Gr(e,Number.POSITIVE_INFINITY);this.wr.forEachInRange([t,r],(e=>{n=n.add(e.pr)}))})),re.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;W.isDocumentKey(i)||(i=i.child(""));const s=new Gr(new W(i),0);let o=new Se(F);return this.wr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.pr)),!0)}),s),re.resolve(this.Dr(o))}Dr(e){const t=[];return e.forEach((e=>{const n=this.Sr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){I(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return re.forEach(t.mutations,(r=>{const i=new Gr(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.wr=n}))}Mn(e){}containsKey(e,t){const n=new Gr(t,0),r=this.wr.firstAfterOrEqual(n);return re.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,re.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Wr{constructor(e){this.vr=e,this.docs=new Ee(W.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return re.resolve(n?n.document.mutableCopy():tt.newInvalidDocument(t))}getEntries(e,t){let n=Qt();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():tt.newInvalidDocument(e))})),re.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Qt();const s=t.path,o=new W(s.child("")),c=this.docs.getIteratorFrom(o);for(;c.hasNext();){const{key:e,value:{document:o}}=c.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||Z(X(o),n)<=0||(r.has(o.key)||Kt(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return re.resolve(i)}getAllFromCollectionGroup(e,t,n,r){E()}Fr(e,t){return re.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Qr(this)}getSize(e){return re.resolve(this.size)}}class Qr extends jr{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.ar.addEntry(e,r)):this.ar.removeEntry(n)})),re.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class Jr{constructor(e){this.persistence=e,this.Mr=new Ht((e=>At(e)),Nt),this.lastRemoteSnapshotVersion=K.min(),this.highestTargetId=0,this.Or=0,this.Nr=new $r,this.targetCount=0,this.Lr=Fr.Nn()}forEachTarget(e,t){return this.Mr.forEach(((e,n)=>t(n))),re.resolve()}getLastRemoteSnapshotVersion(e){return re.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return re.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),re.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),re.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Lr=new Fr(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,re.resolve()}updateTargetData(e,t){return this.qn(t),re.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,re.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Mr.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Mr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),re.waitFor(i).next((()=>r))}getTargetCount(e){return re.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return re.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),re.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),re.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),re.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return re.resolve(n)}containsKey(e,t){return re.resolve(this.Nr.containsKey(t))}}class Xr{constructor(e,t){this.Br={},this.overlays={},this.kr=new fe(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Jr(this),this.indexManager=new Mr,this.remoteDocumentCache=function(e){return new Wr(e)}((e=>this.referenceDelegate.Kr(e))),this.serializer=new Pr(t),this.$r=new Kr(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new zr,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Br[e.toKey()];return n||(n=new Hr(t,this.referenceDelegate),this.Br[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){v("MemoryPersistence","Starting transaction:",e);const r=new Yr(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((e=>this.referenceDelegate.Wr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gr(e,t){return re.or(Object.values(this.Br).map((n=>()=>n.containsKey(e,t))))}}class Yr extends te{constructor(e){super(),this.currentSequenceNumber=e}}class Zr{constructor(e){this.persistence=e,this.zr=new $r,this.jr=null}static Hr(e){return new Zr(e)}get Jr(){if(this.jr)return this.jr;throw E()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),re.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),re.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),re.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach((e=>this.Jr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Jr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return re.forEach(this.Jr,(n=>{const r=W.fromPath(n);return this.Yr(e,r).next((e=>{e||t.removeEntry(r,K.min())}))})).next((()=>(this.jr=null,t.apply(e))))}updateLimboDocument(e,t){return this.Yr(e,t).next((e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())}))}Kr(e){return 0}Yr(e,t){return re.or([()=>re.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class ei{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=r}static Ki(e,t){let n=rn(),r=rn();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new ei(e,t.fromCache,n,r)}}class ti{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ni{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=Object(h.w)()?8:se.v(Object(h.o)())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ji(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.Hi(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new ti;return this.Ji(e,t,n).next((r=>{if(i.result=r,this.Ui)return this.Yi(e,t,n,r.size)}))})).next((()=>i.result))}Yi(e,t,n,r){return n.documentReadCount<this.Wi?(y()<=c.a.DEBUG&&v("QueryEngine","SDK will not create cache indexes for query:",Bt(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),re.resolve()):(y()<=c.a.DEBUG&&v("QueryEngine","Query:",Bt(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(y()<=c.a.DEBUG&&v("QueryEngine","The SDK decides to create cache indexes for query:",Bt(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ut(t))):re.resolve())}ji(e,t){if(Lt(t))return re.resolve(null);let n=Ut(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Ft(t,null,"F"),n=Ut(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=rn(...r);return this.zi.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.Zi(t,r);return this.Xi(t,s,i,n.readTime)?this.ji(e,Ft(t,null,"F")):this.es(e,s,t,n)}))))})))))}Hi(e,t,n,r){return Lt(t)||r.isEqual(K.min())?re.resolve(null):this.zi.getDocuments(e,n).next((i=>{const s=this.Zi(t,i);return this.Xi(t,s,n,r)?re.resolve(null):(y()<=c.a.DEBUG&&v("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Bt(t)),this.es(e,s,t,J(r,-1)).next((e=>e)))}))}Zi(e,t){let n=new Se($t(e));return t.forEach(((t,r)=>{Kt(e,r)&&(n=n.add(r))})),n}Xi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(e,t,n){return y()<=c.a.DEBUG&&v("QueryEngine","Using full collection scan to execute query:",Bt(t)),this.zi.getDocumentsMatchingQuery(e,t,Y.min(),n)}es(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class ri{constructor(e,t,n,r){this.persistence=e,this.ts=t,this.serializer=r,this.ns=new Ee(F),this.rs=new Ht((e=>At(e)),Nt),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Br(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.ns)))}}function ii(e,t,n,r){return new ri(e,t,n,r)}async function si(e,t){const n=S(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n._s(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=rn();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({us:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function oi(e){const t=S(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Qr.getLastRemoteSnapshotVersion(e)))}function ai(e,t,n){let r=rn(),i=rn();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=Qt();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(K.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):v("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{cs:r,ls:i}}))}function ci(e,t){const n=S(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Qr.getTargetData(e,t).next((i=>i?(r=i,re.resolve(r)):n.Qr.allocateTargetId(e).next((i=>(r=new Dr(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Qr.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.ns.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(e.targetId,e),n.rs.set(t,e.targetId)),e}))}async function ui(e,t,n){const r=S(e),i=r.ns.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!ce(e))throw e;v("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.ns=r.ns.remove(t),r.rs.delete(i.target)}function hi(e,t,n){const r=S(e);let i=K.min(),s=rn();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=S(e),i=r.rs.get(n);return void 0!==i?re.resolve(r.ns.get(i)):r.Qr.getTargetData(t,n)}(r,e,Ut(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.ts.getDocumentsMatchingQuery(e,t,n?i:K.min(),n?s:rn()))).next((e=>(di(r,zt(t),e),{documents:e,hs:s})))))}function di(e,t,n){let r=e.ss.get(t)||K.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.ss.set(t,r)}class fi{constructor(){this.activeTargetIds=on()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class pi{constructor(){this.no=new fi,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new fi,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class gi{io(e){}shutdown(){}}class mi{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){v("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){v("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let yi=null;function vi(){return null===yi?yi=268435456+Math.round(2147483648*Math.random()):yi++,"0x"+yi.toString(16)}const wi={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class _i{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}const Ti="WebChannelConnection";class Ei extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=t+"://"+e.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(e,t,n,r,i){const s=vi(),o=this.bo(e,t.toUriEncodedString());v("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const c={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(c,r,i),this.Co(e,o,c,n).then((t=>(v("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw _("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,r,i,s){return this.So(e,t,n,r,i)}Do(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+m,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}bo(e,t){const n=wi[e];return`${this.fo}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,n,r){const i=vi();return new Promise(((s,o)=>{const c=new l.h;c.setWithCredentials(!0),c.listenOnce(l.c.COMPLETE,(()=>{try{switch(c.getLastErrorCode()){case l.a.NO_ERROR:const t=c.getResponseJson();v(Ti,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case l.a.TIMEOUT:v(Ti,`RPC '${e}' ${i} timed out`),o(new k(C.DEADLINE_EXCEEDED,"Request time out"));break;case l.a.HTTP_ERROR:const n=c.getStatus();if(v(Ti,`RPC '${e}' ${i} failed with status:`,n,"response text:",c.getResponseText()),n>0){let e=c.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(t)>=0?t:C.UNKNOWN}(t.status);o(new k(e,t.message))}else o(new k(C.UNKNOWN,"Server responded with status "+c.getStatus()))}else o(new k(C.UNAVAILABLE,"Connection failed."));break;default:E()}}finally{v(Ti,`RPC '${e}' ${i} completed.`)}}));const a=JSON.stringify(r);v(Ti,`RPC '${e}' ${i} sending request:`,r),c.send(t,"POST",a,n,15)}))}Fo(e,t,n){const r=vi(),i=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=Object(l.i)(),o=Object(l.j)(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},a=this.longPollingOptions.timeoutSeconds;void 0!==a&&(c.longPollingTimeout=Math.round(1e3*a)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Do(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;const u=i.join("");v(Ti,`Creating RPC '${e}' stream ${r}: ${u}`,c);const h=s.createWebChannel(u,c);let d=!1,f=!1;const m=new _i({lo:t=>{f?v(Ti,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(d||(v(Ti,`Opening RPC '${e}' stream ${r} transport.`),h.open(),d=!0),v(Ti,`RPC '${e}' stream ${r} sending:`,t),h.send(t))},ho:()=>h.close()}),y=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return y(h,l.g.EventType.OPEN,(()=>{f||v(Ti,`RPC '${e}' stream ${r} transport opened.`)})),y(h,l.g.EventType.CLOSE,(()=>{f||(f=!0,v(Ti,`RPC '${e}' stream ${r} transport closed`),m.Vo())})),y(h,l.g.EventType.ERROR,(t=>{f||(f=!0,_(Ti,`RPC '${e}' stream ${r} transport errored:`,t),m.Vo(new k(C.UNAVAILABLE,"The operation could not be completed")))})),y(h,l.g.EventType.MESSAGE,(t=>{var n;if(!f){const i=t.data[0];I(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){v(Ti,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=Un[e];if(void 0!==t)return Fn(t)}(t),i=o.message;void 0===n&&(n=C.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),f=!0,m.Vo(new k(n,i)),h.close()}else v(Ti,`RPC '${e}' stream ${r} received:`,i),m.mo(i)}})),y(o,l.b.STAT_EVENT,(t=>{t.stat===l.f.PROXY?v(Ti,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===l.f.NOPROXY&&v(Ti,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{m.Ro()}),0),m}}function Ii(){return"undefined"!=typeof document?document:null}function bi(e){return new or(e,!0)}class Si{constructor(e,t,n=1e3,r=1.5,i=6e4){this.oi=e,this.timerId=t,this.Mo=n,this.xo=r,this.Oo=i,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();const t=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Bo),r=Math.max(0,t-n);r>0&&v("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Bo=Date.now(),e()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Lo&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){null!==this.Lo&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}}class Ci{constructor(e,t,n,r,i,s,o,c){this.oi=e,this.$o=n,this.Uo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=c,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Si(e,t)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(e){this.n_(),this.stream.send(e)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(e,t){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==e?this.jo.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(w(t.toString()),w("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):t&&t.code===C.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.To(t)}i_(){}auth(){this.state=1;const e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Wo===t&&this.o_(e,n)}),(t=>{e((()=>{const e=new k(C.UNKNOWN,"Fetching auth token failed: "+t.message);return this.__(e)}))}))}o_(e,t){const n=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((e=>{n((()=>this.__(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(e){return v("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget((()=>this.Wo===e?t():(v("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class ki extends Ci{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:E()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(I(void 0===t||"string"==typeof t),Ne.fromBase64String(t||"")):(I(void 0===t||t instanceof Uint8Array),Ne.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,c=o&&function(e){const t=void 0===e.code?C.UNKNOWN:Fn(e.code);return new k(t,e.message||"")}(o);n=new Xn(r,i,s,c||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=gr(e,r.document.name),s=lr(r.document.updateTime),o=r.document.createTime?lr(r.document.createTime):K.min(),c=new et({mapValue:{fields:r.document.fields}}),a=tt.newFoundDocument(i,s,o,c),u=r.targetIds||[],h=r.removedTargetIds||[];n=new Qn(u,h,a.key,a)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=gr(e,r.document),s=r.readTime?lr(r.readTime):K.min(),o=tt.newNoDocument(i,s),c=r.removedTargetIds||[];n=new Qn([],c,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=gr(e,r.document),s=r.removedTargetIds||[];n=new Qn([],s,i,null)}else{if(!("filter"in t))return E();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new Mn(r,i),o=e.targetId;n=new Jn(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return K.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?K.min():t.readTime?lr(t.readTime):K.min()}(e);return this.listener.u_(t,n)}c_(e){const t={};t.database=vr(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Rt(r)?{documents:_r(e,r)}:{query:Tr(e,r).ut},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=ur(e,t.resumeToken);const r=ar(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(K.min())>0){n.readTime=cr(e,t.snapshotVersion.toTimestamp());const r=ar(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return E()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.t_(t)}l_(e){const t={};t.database=vr(this.serializer),t.removeTarget=e,this.t_(t)}}class Ai extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new k(C.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.So(e,fr(t,n),r,i,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new k(C.UNKNOWN,e.toString())}))}vo(e,t,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.vo(e,fr(t,n),r,s,o,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new k(C.UNKNOWN,e.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class Ni{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(w(t),this.g_=!1):v("OnlineStateTracker",t)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class Ri{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io((e=>{n.enqueueAndForget((async()=>{Fi(this)&&(v("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=S(e);t.v_.add(4),await Di(t),t.x_.set("Unknown"),t.v_.delete(4),await Oi(t)}(this))}))})),this.x_=new Ni(n,r)}}async function Oi(e){if(Fi(e))for(const t of e.F_)await t(!0)}async function Di(e){for(const t of e.F_)await t(!1)}function Pi(e,t){const n=S(e);n.C_.has(t.targetId)||(n.C_.set(t.targetId,t),Vi(n)?Ui(n):Hi(n).Jo()&&xi(n,t))}function Li(e,t){const n=S(e),r=Hi(n);n.C_.delete(t),r.Jo()&&Mi(n,t),0===n.C_.size&&(r.Jo()?r.Xo():Fi(n)&&n.x_.set("Unknown"))}function xi(e,t){if(e.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(K.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Hi(e).c_(t)}function Mi(e,t){e.O_.Oe(t),Hi(e).l_(t)}function Ui(e){e.O_=new Zn({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>e.C_.get(t)||null,nt:()=>e.datastore.serializer.databaseId}),Hi(e).start(),e.x_.p_()}function Vi(e){return Fi(e)&&!Hi(e).Ho()&&e.C_.size>0}function Fi(e){return 0===S(e).v_.size}function ji(e){e.O_=void 0}async function qi(e){e.C_.forEach(((t,n)=>{xi(e,t)}))}async function Bi(e,t){ji(e),Vi(e)?(e.x_.S_(t),Ui(e)):e.x_.set("Unknown")}async function Ki(e,t,n){if(e.x_.set("Online"),t instanceof Xn&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.C_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.C_.delete(r),e.O_.removeTarget(r))}(e,t)}catch(n){v("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await zi(e,n)}else if(t instanceof Qn?e.O_.$e(t):t instanceof Jn?e.O_.Je(t):e.O_.Ge(t),!n.isEqual(K.min()))try{const t=await oi(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.O_.it(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.C_.get(r);i&&e.C_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.C_.get(t);if(!r)return;e.C_.set(t,r.withResumeToken(Ne.EMPTY_BYTE_STRING,r.snapshotVersion)),Mi(e,t);const i=new Dr(r.target,t,n,r.sequenceNumber);xi(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){v("RemoteStore","Failed to raise snapshot:",t),await zi(e,t)}}async function zi(e,t,n){if(!ce(t))throw t;e.v_.add(1),await Di(e),e.x_.set("Offline"),n||(n=()=>oi(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{v("RemoteStore","Retrying IndexedDB access"),await n(),e.v_.delete(1),await Oi(e)}))}async function $i(e,t){const n=S(e);n.asyncQueue.verifyOperationInProgress(),v("RemoteStore","RemoteStore received new credentials");const r=Fi(n);n.v_.add(3),await Di(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.v_.delete(3),await Oi(n)}async function Gi(e,t){const n=S(e);t?(n.v_.delete(2),await Oi(n)):t||(n.v_.add(2),await Di(n),n.x_.set("Unknown"))}function Hi(e){return e.N_||(e.N_=function(e,t,n){const r=S(e);return r.R_(),new ki(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:qi.bind(null,e),To:Bi.bind(null,e),u_:Ki.bind(null,e)}),e.F_.push((async t=>{t?(e.N_.Zo(),Vi(e)?Ui(e):e.x_.set("Unknown")):(await e.N_.stop(),ji(e))}))),e.N_}class Wi{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new A,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new Wi(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new k(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Qi(e,t){if(w("AsyncQueue",`${t}: ${e}`),ce(e))return new k(C.UNAVAILABLE,`${t}: ${e}`);throw e}class Ji{constructor(e){this.comparator=e?(t,n)=>e(t,n)||W.comparator(t.key,n.key):(e,t)=>W.comparator(e.key,t.key),this.keyedMap=Xt(),this.sortedSet=new Ee(this.comparator)}static emptySet(e){return new Ji(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ji))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Ji;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Xi{constructor(){this.B_=new Ee(W.comparator)}track(e){const t=e.doc.key,n=this.B_.get(t);n?0!==e.type&&3===n.type?this.B_=this.B_.insert(t,e):3===e.type&&1!==n.type?this.B_=this.B_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.B_=this.B_.remove(t):1===e.type&&2===n.type?this.B_=this.B_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):E():this.B_=this.B_.insert(t,e)}k_(){const e=[];return this.B_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Yi{constructor(e,t,n,r,i,s,o,c,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=c,this.hasCachedResults=a}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new Yi(e,t,Ji.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&jt(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Zi{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some((e=>e.U_()))}}class es{constructor(){this.queries=new Ht((e=>qt(e)),jt),this.onlineState="Unknown",this.W_=new Set}}async function ts(e,t){const n=S(e);let r=3;const i=t.query;let s=n.queries.get(i);s?!s.K_()&&t.U_()&&(r=2):(s=new Zi,r=t.U_()?0:1);try{switch(r){case 0:s.q_=await n.onListen(i,!0);break;case 1:s.q_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=Qi(e,`Initialization of query '${Bt(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,s),s.Q_.push(t),t.G_(n.onlineState),s.q_&&t.z_(s.q_)&&ss(n)}async function ns(e,t){const n=S(e),r=t.query;let i=3;const s=n.queries.get(r);if(s){const e=s.Q_.indexOf(t);e>=0&&(s.Q_.splice(e,1),0===s.Q_.length?i=t.U_()?0:1:!s.K_()&&t.U_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function rs(e,t){const n=S(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.Q_)t.z_(e)&&(r=!0);i.q_=e}}r&&ss(n)}function is(e,t,n){const r=S(e),i=r.queries.get(t);if(i)for(const e of i.Q_)e.onError(n);r.queries.delete(t)}function ss(e){e.W_.forEach((e=>{e.next()}))}var os,as;(as=os||(os={})).j_="default",as.Cache="cache";class cs{constructor(e,t,n){this.query=e,this.H_=t,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=n||{}}z_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Yi(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.J_?this.Z_(e)&&(this.H_.next(e),t=!0):this.X_(e,this.onlineState)&&(this.ea(e),t=!0),this.Y_=e,t}onError(e){this.H_.error(e)}G_(e){this.onlineState=e;let t=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,e)&&(this.ea(this.Y_),t=!0),t}X_(e,t){if(!e.fromCache)return!0;if(!this.U_())return!0;const n="Offline"!==t;return(!this.options.ta||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Z_(e){if(e.docChanges.length>0)return!0;const t=this.Y_&&this.Y_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ea(e){e=Yi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.J_=!0,this.H_.next(e)}U_(){return this.options.source!==os.Cache}}class us{constructor(e){this.key=e}}class hs{constructor(e){this.key=e}}class ls{constructor(e,t){this.query=e,this.ua=t,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=rn(),this.mutatedKeys=rn(),this.ha=$t(e),this.Pa=new Ji(this.ha)}get Ia(){return this.ua}Ta(e,t){const n=t?t.Ea:new Xi,r=t?t.Pa:this.Pa;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const c="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,a="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),h=Kt(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.da(u,h)||(n.track({type:2,doc:h}),f=!0,(c&&this.ha(h,c)>0||a&&this.ha(h,a)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(c||a)&&(o=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Pa:s,Ea:n,Xi:o,mutatedKeys:i}}da(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.Pa;this.Pa=e.Pa,this.mutatedKeys=e.mutatedKeys;const s=e.Ea.k_();s.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return E()}};return n(e)-n(t)}(e.type,t.type)||this.ha(e.doc,t.doc))),this.Aa(n),r=null!=r&&r;const o=t&&!r?this.Ra():[],c=0===this.la.size&&this.current&&!r?1:0,a=c!==this.ca;return this.ca=c,0!==s.length||a?{snapshot:new Yi(this.query,e.Pa,i,s,e.mutatedKeys,0===c,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),Va:o}:{Va:o}}G_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new Xi,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(e){return!this.ua.has(e)&&!!this.Pa.has(e)&&!this.Pa.get(e).hasLocalMutations}Aa(e){e&&(e.addedDocuments.forEach((e=>this.ua=this.ua.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.ua=this.ua.delete(e))),this.current=e.current)}Ra(){if(!this.current)return[];const e=this.la;this.la=rn(),this.Pa.forEach((e=>{this.ma(e.key)&&(this.la=this.la.add(e.key))}));const t=[];return e.forEach((e=>{this.la.has(e)||t.push(new hs(e))})),this.la.forEach((n=>{e.has(n)||t.push(new us(n))})),t}fa(e){this.ua=e.hs,this.la=rn();const t=this.Ta(e.documents);return this.applyChanges(t,!0)}ga(){return Yi.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,0===this.ca,this.hasCachedResults)}}class ds{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class fs{constructor(e){this.key=e,this.pa=!1}}class ps{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.ya={},this.wa=new Ht((e=>qt(e)),jt),this.Sa=new Map,this.ba=new Set,this.Da=new Ee(W.comparator),this.Ca=new Map,this.va=new $r,this.Fa={},this.Ma=new Map,this.xa=Fr.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return!0===this.Oa}}async function gs(e,t,n=!0){const r=Ds(e);let i;const s=r.wa.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ga()):i=await ys(r,t,n,!0),i}async function ms(e,t){const n=Ds(e);await ys(n,t,!0,!1)}async function ys(e,t,n,r){const i=await ci(e.localStore,Ut(t)),s=i.targetId,o=n?e.sharedClientState.addLocalQueryTarget(s):"not-current";let c;return r&&(c=await vs(e,t,s,"current"===o,i.resumeToken)),e.isPrimaryClient&&n&&Pi(e.remoteStore,i),c}async function vs(e,t,n,r,i){e.Na=(t,n,r)=>async function(e,t,n,r){let i=t.view.Ta(n);i.Xi&&(i=await hi(e.localStore,t.query,!1).then((({documents:e})=>t.view.Ta(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),c=t.view.applyChanges(i,e.isPrimaryClient,s,o);return Cs(e,t.targetId,c.Va),c.snapshot}(e,t,n,r);const s=await hi(e.localStore,t,!0),o=new ls(t,s.hs),c=o.Ta(s.documents),a=Wn.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(c,e.isPrimaryClient,a);Cs(e,n,u.Va);const h=new ds(t,n,o);return e.wa.set(t,h),e.Sa.has(n)?e.Sa.get(n).push(t):e.Sa.set(n,[t]),u.snapshot}async function ws(e,t,n){const r=S(e),i=r.wa.get(t),s=r.Sa.get(i.targetId);if(s.length>1)return r.Sa.set(i.targetId,s.filter((e=>!jt(e,t)))),void r.wa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await ui(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Li(r.remoteStore,i.targetId),bs(r,i.targetId)})).catch(ne)):(bs(r,i.targetId),await ui(r.localStore,i.targetId,!0))}async function _s(e,t){const n=S(e),r=n.wa.get(t),i=n.Sa.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Li(n.remoteStore,r.targetId))}async function Ts(e,t){const n=S(e);try{const e=await function(e,t){const n=S(e),r=t.snapshotVersion;let i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;const o=[];t.targetChanges.forEach(((s,c)=>{const a=i.get(c);if(!a)return;o.push(n.Qr.removeMatchingKeys(e,s.removedDocuments,c).next((()=>n.Qr.addMatchingKeys(e,s.addedDocuments,c))));let u=a.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(c)?u=u.withResumeToken(Ne.EMPTY_BYTE_STRING,K.min()).withLastLimboFreeSnapshotVersion(K.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(c,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,u,s)&&o.push(n.Qr.updateTargetData(e,u))}));let c=Qt(),a=rn();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(ai(e,s,t.documentUpdates).next((e=>{c=e.cs,a=e.ls}))),!r.isEqual(K.min())){const t=n.Qr.getLastRemoteSnapshotVersion(e).next((t=>n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return re.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,c,a))).next((()=>c))})).then((e=>(n.ns=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Ca.get(t);r&&(I(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.pa=!0:e.modifiedDocuments.size>0?I(r.pa):e.removedDocuments.size>0&&(I(r.pa),r.pa=!1))})),await Ns(n,e,t)}catch(e){await ne(e)}}function Es(e,t,n){const r=S(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.wa.forEach(((n,r)=>{const i=r.view.G_(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=S(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.Q_)e.G_(t)&&(r=!0)})),r&&ss(n)}(r.eventManager,t),e.length&&r.ya.u_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Is(e,t,n){const r=S(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Ca.get(t),s=i&&i.key;if(s){let e=new Ee(W.comparator);e=e.insert(s,tt.newNoDocument(s,K.min()));const n=rn().add(s),i=new Hn(K.min(),new Map,new Ee(F),e,n);await Ts(r,i),r.Da=r.Da.remove(s),r.Ca.delete(t),As(r)}else await ui(r.localStore,t,!1).then((()=>bs(r,t,n))).catch(ne)}function bs(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Sa.get(t))e.wa.delete(r),n&&e.ya.La(r,n);e.Sa.delete(t),e.isPrimaryClient&&e.va.Vr(t).forEach((t=>{e.va.containsKey(t)||Ss(e,t)}))}function Ss(e,t){e.ba.delete(t.path.canonicalString());const n=e.Da.get(t);null!==n&&(Li(e.remoteStore,n),e.Da=e.Da.remove(t),e.Ca.delete(n),As(e))}function Cs(e,t,n){for(const r of n)r instanceof us?(e.va.addReference(r.key,t),ks(e,r)):r instanceof hs?(v("SyncEngine","Document no longer in limbo: "+r.key),e.va.removeReference(r.key,t),e.va.containsKey(r.key)||Ss(e,r.key)):E()}function ks(e,t){const n=t.key,r=n.path.canonicalString();e.Da.get(n)||e.ba.has(r)||(v("SyncEngine","New document in limbo: "+n),e.ba.add(r),As(e))}function As(e){for(;e.ba.size>0&&e.Da.size<e.maxConcurrentLimboResolutions;){const t=e.ba.values().next().value;e.ba.delete(t);const n=new W($.fromString(t)),r=e.xa.next();e.Ca.set(r,new fs(n)),e.Da=e.Da.insert(n,r),Pi(e.remoteStore,new Dr(Ut(Pt(n.path)),r,"TargetPurposeLimboResolution",fe._e))}}async function Ns(e,t,n){const r=S(e),i=[],s=[],o=[];r.wa.isEmpty()||(r.wa.forEach(((e,c)=>{o.push(r.Na(c,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=ei.Ki(c.targetId,e);s.push(t)}})))})),await Promise.all(o),r.ya.u_(i),await async function(e,t){const n=S(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>re.forEach(t,(t=>re.forEach(t.qi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>re.forEach(t.Qi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!ce(e))throw e;v("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.ns.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(t,i)}}}(r.localStore,s))}async function Rs(e,t){const n=S(e);if(!n.currentUser.isEqual(t)){v("SyncEngine","User change. New user:",t.toKey());const e=await si(n.localStore,t);n.currentUser=t,function(e,t){e.Ma.forEach((e=>{e.forEach((e=>{e.reject(new k(C.CANCELLED,t))}))})),e.Ma.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Ns(n,e.us)}}function Os(e,t){const n=S(e),r=n.Ca.get(t);if(r&&r.pa)return rn().add(r.key);{let e=rn();const r=n.Sa.get(t);if(!r)return e;for(const t of r){const r=n.wa.get(t);e=e.unionWith(r.view.Ia)}return e}}function Ds(e){const t=S(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ts.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Os.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Is.bind(null,t),t.ya.u_=rs.bind(null,t.eventManager),t.ya.La=is.bind(null,t.eventManager),t}class Ps{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=bi(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return ii(this.persistence,new ni,e.initialUser,this.serializer)}createPersistence(e){return new Xr(Zr.Hr,this.serializer)}createSharedClientState(e){return new pi}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Ls{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Es(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Rs.bind(null,this.syncEngine),await Gi(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new es}createDatastore(e){const t=bi(e.databaseInfo.databaseId),n=function(e){return new Ei(e)}(e.databaseInfo);return function(e,t,n,r){return new Ai(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new Ri(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>Es(this.syncEngine,e,0)),mi.D()?new mi:new gi)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const c=new ps(e,t,n,r,i,s);return o&&(c.Oa=!0),c}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e;await async function(e){const t=S(e);v("RemoteStore","RemoteStore shutting down."),t.v_.add(5),await Di(t),t.M_.shutdown(),t.x_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate()}}class xs{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.qa(this.observer.next,e)}error(e){this.observer.error?this.qa(this.observer.error,e):w("Uncaught Error in snapshot listener:",e.toString())}Qa(){this.muted=!0}qa(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class Ms{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=f.UNAUTHENTICATED,this.clientId=V.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{v("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(v("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new k(C.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new A;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Qi(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Us(e,t){e.asyncQueue.verifyOperationInProgress(),v("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await si(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function Vs(e,t){e.asyncQueue.verifyOperationInProgress();const n=await js(e);v("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>$i(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>$i(t.remoteStore,n))),e._onlineComponents=t}function Fs(e){return"FirebaseError"===e.name?e.code===C.FAILED_PRECONDITION||e.code===C.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function js(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){v("FirestoreClient","Using user provided OfflineComponentProvider");try{await Us(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!Fs(n))throw n;_("Error using user provided cache. Falling back to memory cache: "+n),await Us(e,new Ps)}}else v("FirestoreClient","Using default OfflineComponentProvider"),await Us(e,new Ps);return e._offlineComponents}async function qs(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(v("FirestoreClient","Using user provided OnlineComponentProvider"),await Vs(e,e._uninitializedComponentsProvider._online)):(v("FirestoreClient","Using default OnlineComponentProvider"),await Vs(e,new Ls))),e._onlineComponents}async function Bs(e){const t=await qs(e),n=t.eventManager;return n.onListen=gs.bind(null,t.syncEngine),n.onUnlisten=ws.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=ms.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=_s.bind(null,t.syncEngine),n}function Ks(e,t,n={}){const r=new A;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new xs({next:n=>{t.enqueueAndForget((()=>ns(e,o))),n.fromCache&&"server"===r.source?i.reject(new k(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new cs(n,s,{includeMetadataChanges:!0,ta:!0});return ts(e,o)}(await Bs(e),e.asyncQueue,t,n,r))),r.promise}function zs(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const $s=new Map;function Gs(e,t,n){if(!n)throw new k(C.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Hs(e){if(!W.isDocumentKey(e))throw new k(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Ws(e){if(W.isDocumentKey(e))throw new k(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Qs(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":E()}function Js(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new k(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Qs(e);throw new k(C.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class Xs{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new k(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new k(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new k(C.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=zs(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new k(C.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new k(C.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new k(C.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ys{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Xs({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new k(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new k(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Xs(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new R;switch(e.type){case"firstParty":return new L(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new k(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=$s.get(e);t&&(v("ComponentProvider","Removing Datastore"),$s.delete(e),t.terminate())}(this),Promise.resolve()}}class Zs{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Zs(this.firestore,e,this._query)}}class eo{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new to(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new eo(this.firestore,e,this._key)}}class to extends Zs{constructor(e,t,n){super(e,t,Pt(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new eo(this.firestore,null,new W(e))}withConverter(e){return new to(this.firestore,e,this._path)}}function no(e,t,...n){if(e=Object(h.n)(e),Gs("collection","path",t),e instanceof Ys){const r=$.fromString(t,...n);return Ws(r),new to(e,null,r)}{if(!(e instanceof eo||e instanceof to))throw new k(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child($.fromString(t,...n));return Ws(r),new to(e.firestore,null,r)}}function ro(e,t,...n){if(e=Object(h.n)(e),1===arguments.length&&(t=V.newId()),Gs("doc","path",t),e instanceof Ys){const r=$.fromString(t,...n);return Hs(r),new eo(e,null,new W(r))}{if(!(e instanceof eo||e instanceof to))throw new k(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child($.fromString(t,...n));return Hs(r),new eo(e.firestore,e instanceof to?e.converter:null,new W(r))}}class io{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new Si(this,"async_queue_retry"),this.cu=()=>{const e=Ii();e&&v("AsyncQueue","Visibility state changed to "+e.visibilityState),this.jo.Ko()};const e=Ii();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.lu(),this.hu(e)}enterRestrictedMode(e){if(!this.iu){this.iu=!0,this.au=e||!1;const t=Ii();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.cu)}}enqueue(e){if(this.lu(),this.iu)return new Promise((()=>{}));const t=new A;return this.hu((()=>this.iu&&this.au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.ru.push(e),this.Pu())))}async Pu(){if(0!==this.ru.length){try{await this.ru[0](),this.ru.shift(),this.jo.reset()}catch(e){if(!ce(e))throw e;v("AsyncQueue","Operation failed with retryable error: "+e)}this.ru.length>0&&this.jo.qo((()=>this.Pu()))}}hu(e){const t=this.nu.then((()=>(this._u=!0,e().catch((e=>{this.ou=e,this._u=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw w("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this._u=!1,e))))));return this.nu=t,t}enqueueAfterDelay(e,t,n){this.lu(),this.uu.indexOf(e)>-1&&(t=0);const r=Wi.createAndSchedule(this,e,t,n,(e=>this.Iu(e)));return this.su.push(r),r}lu(){this.ou&&E()}verifyOperationInProgress(){}async Tu(){let e;do{e=this.nu,await e}while(e!==this.nu)}Eu(e){for(const t of this.su)if(t.timerId===e)return!0;return!1}du(e){return this.Tu().then((()=>{this.su.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.su)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tu()}))}Au(e){this.uu.push(e)}Iu(e){const t=this.su.indexOf(e);this.su.splice(t,1)}}class so extends Ys{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new io,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||co(this),this._firestoreClient.terminate()}}function oo(e,t){const n="object"==typeof e?e:Object(r.f)(),i="string"==typeof e?e:t||"(default)",s=Object(r.b)(n,"firestore").getImmediate({identifier:i});if(!s._initialized){const e=Object(h.l)("firestore");e&&function(e,t,n,r={}){var i;const s=(e=Js(e,Ys))._getSettings(),o=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&_("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=f.MOCK_USER;else{t=Object(h.f)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new k(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new f(s)}e._authCredentials=new O(new N(t,n))}}(s,...e)}return s}function ao(e){return e._firestoreClient||co(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function co(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new Ue(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,zs(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new Ms(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class uo{constructor(e){this._byteString=e}static fromBase64String(e){try{return new uo(Ne.fromBase64String(e))}catch(e){throw new k(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new uo(Ne.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ho{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new k(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new H(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class lo{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new k(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new k(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return F(this._lat,e._lat)||F(this._long,e._long)}}const fo=new RegExp("[~\\*/\\[\\]]");function po(e,t,n){if(t.search(fo)>=0)throw go(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new ho(...t.split("."))._internalPath}catch(r){throw go(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function go(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let c=`Function ${t}() called with invalid data`;n&&(c+=" (via `toFirestore()`)"),c+=". ";let a="";return(s||o)&&(a+=" (found",s&&(a+=` in field ${r}`),o&&(a+=` in document ${i}`),a+=")"),new k(C.INVALID_ARGUMENT,c+e+a)}class mo{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new eo(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new yo(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(vo("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class yo extends mo{data(){return super.data()}}function vo(e,t){return"string"==typeof t?po(e,t):t instanceof ho?t._internalPath:t._delegate._internalPath}function wo(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new k(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class _o{convertValue(e,t="none"){switch(je(e)){case 0:return null;case 1:return e.booleanValue;case 2:return De(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Pe(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw E()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return _e(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new lo(De(e.latitude),De(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=xe(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Me(e));default:return null}}convertTimestamp(e){const t=Oe(e);return new B(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=$.fromString(e);I(Or(n));const r=new Ve(n.get(1),n.get(3)),i=new W(n.popFirst(5));return r.isEqual(t)||w(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class To{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Eo extends mo{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Io(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(vo("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Io extends Eo{data(e={}){return super.data(e)}}class bo{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new To(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Io(this._firestore,this._userDataWriter,n.key,n,new To(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new k(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new Io(e._firestore,e._userDataWriter,n.doc.key,n.doc,new To(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new Io(e._firestore,e._userDataWriter,t.doc.key,t.doc,new To(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:So(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function So(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return E()}}class Co extends _o{constructor(e){super(),this.firestore=e}convertBytes(e){return new uo(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new eo(this.firestore,null,t)}}function ko(e){e=Js(e,Zs);const t=Js(e.firestore,so),n=ao(t),r=new Co(t);return wo(e._query),Ks(n,e._query).then((n=>new bo(t,r,e,n)))}new WeakMap;!function(e,t=!0){!function(e){m=e}(r.a),Object(r.d)(new o.a("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new so(new D(e.getProvider("auth-internal")),new M(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new k(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ve(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Object(r.h)(d,"4.5.1",e),Object(r.h)(d,"4.5.1","esm2017")}()}).call(this,n(122))},360:function(e,t,n){"use strict";n.d(t,"a",(function(){return Ye})),n.d(t,"b",(function(){return On})),n.d(t,"c",(function(){return ut})),n.d(t,"d",(function(){return Bt}));var r=n(31),o=n(2),c=n(52);function h(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var l=n(51);function d(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const f=d,m=new o.b("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),y=new c.b("@firebase/auth");function v(e,...t){y.logLevel<=c.a.ERROR&&y.error(`Auth (${r.a}): ${e}`,...t)}function w(e,...t){throw S(e,...t)}function _(e,...t){return S(e,...t)}function T(e,code,t){const n=Object.assign(Object.assign({},f()),{[code]:t});return new o.b("auth","Firebase",n).create(code,{appName:e.name})}function E(e){return T(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function I(e,object,t){if(!(object instanceof t))throw t.name!==object.constructor.name&&w(e,"argument-error"),T(e,"argument-error",`Type of ${object.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function S(e,...t){if("string"!=typeof e){const code=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(code,...n)}return m.create(e,...t)}function C(e,t,...n){if(!e)throw S(t,...n)}function k(e){const t="INTERNAL ASSERTION FAILED: "+e;throw v(t),new Error(t)}function A(e,t){e||k(t)}function N(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function R(){return"http:"===O()||"https:"===O()}function O(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class D{constructor(e,t){this.shortDelay=e,this.longDelay=t,A(t>e,"Short delay should be less than long delay!"),this.isMobile=Object(o.u)()||Object(o.v)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(R()||Object(o.q)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function P(e,path){A(e.emulator,"Emulator should always be set here");const{url:t}=e.emulator;return path?`${t}${path.startsWith("/")?path.slice(1):path}`:t}class L{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void k("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void k("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void k("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const x={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},M=new D(3e4,6e4);function U(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function V(e,t,path,n,r={}){return F(e,r,(async()=>{let body={},r={};n&&("GET"===t?r=n:body={body:JSON.stringify(n)});const c=Object(o.x)(Object.assign({key:e.config.apiKey},r)).slice(1),h=await e._getAdditionalHeaders();return h["Content-Type"]="application/json",e.languageCode&&(h["X-Firebase-Locale"]=e.languageCode),L.fetch()(B(e,e.config.apiHost,path,c),Object.assign({method:t,headers:h,referrerPolicy:"no-referrer"},body))}))}async function F(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},x),t);try{const t=new z(e),o=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const c=await o.json();if("needConfirmation"in c)throw $(e,"account-exists-with-different-credential",c);if(o.ok&&!("errorMessage"in c))return c;{const t=o.ok?c.errorMessage:c.error.message,[n,h]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw $(e,"credential-already-in-use",c);if("EMAIL_EXISTS"===n)throw $(e,"email-already-in-use",c);if("USER_DISABLED"===n)throw $(e,"user-disabled",c);const l=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw T(e,l,h);w(e,l)}}catch(t){if(t instanceof o.c)throw t;w(e,"network-request-failed",{message:String(t)})}}async function j(e,t,path,n,r={}){const o=await V(e,t,path,n,r);return"mfaPendingCredential"in o&&w(e,"multi-factor-auth-required",{_serverResponse:o}),o}function B(e,t,path,n){const base=`${t}${path}?${n}`;return e.config.emulator?P(e.config,base):`${e.config.apiScheme}://${base}`}function K(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class z{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(_(this.auth,"network-request-failed"))),M.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function $(e,code,t){const n={appName:e.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const r=_(e,code,n);return r.customData._tokenResponse=t,r}function G(e){return void 0!==e&&void 0!==e.enterprise}class H{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return K(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function W(e,t){return V(e,"GET","/v2/recaptchaConfig",U(e,t))}async function Q(e,t){return V(e,"POST","/v1/accounts:lookup",t)}function J(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function X(e){return 1e3*Number(e)}function Y(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return v("JWT malformed, contained fewer than 3 sections"),null;try{const e=Object(o.d)(n);return e?JSON.parse(e):(v("Failed to decode base64 JWT payload"),null)}catch(e){return v("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function Z(e){const t=Y(e);return C(t,"internal-error"),C(void 0!==t.exp,"internal-error"),C(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function ee(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof o.c&&function({code:code}){return"auth/user-disabled"===code||"auth/user-token-expired"===code}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class te{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class ne{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=J(this.lastLoginAt),this.creationTime=J(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function re(e){var t;const n=e.auth,r=await e.getIdToken(),o=await ee(e,Q(n,{idToken:r}));C(null==o?void 0:o.users.length,n,"internal-error");const c=o.users[0];e._notifyReloadListener(c);const h=(null===(t=c.providerUserInfo)||void 0===t?void 0:t.length)?ie(c.providerUserInfo):[],l=(d=e.providerData,f=h,[...d.filter((e=>!f.some((t=>t.providerId===e.providerId)))),...f]);var d,f;const m=e.isAnonymous,y=!(e.email&&c.passwordHash||(null==l?void 0:l.length)),v=!!m&&y,w={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:l,metadata:new ne(c.createdAt,c.lastLoginAt),isAnonymous:v};Object.assign(e,w)}function ie(e){return e.map((e=>{var{providerId:t}=e,n=h(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class se{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){C(e.idToken,"internal-error"),C(void 0!==e.idToken,"internal-error"),C(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):Z(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){C(0!==e.length,"internal-error");const t=Z(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(C(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:c}=await async function(e,t){const n=await F(e,{},(async()=>{const body=Object(o.x)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:r}=e.config,c=B(e,n,"/v1/token",`key=${r}`),h=await e._getAdditionalHeaders();return h["Content-Type"]="application/x-www-form-urlencoded",L.fetch()(c,{method:"POST",headers:h,body:body})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(c))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,object){const{refreshToken:t,accessToken:n,expirationTime:r}=object,o=new se;return t&&(C("string"==typeof t,"internal-error",{appName:e}),o.refreshToken=t),n&&(C("string"==typeof n,"internal-error",{appName:e}),o.accessToken=n),r&&(C("number"==typeof r,"internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new se,this.toJSON())}_performRefresh(){return k("not implemented")}}function oe(e,t){C("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ae{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,o=h(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new te(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new ne(o.createdAt||void 0,o.lastLoginAt||void 0)}async getIdToken(e){const t=await ee(this,this.stsTokenManager.getToken(this.auth,e));return C(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=Object(o.n)(e),r=await n.getIdToken(t),c=Y(r);C(c&&c.exp&&c.auth_time&&c.iat,n.auth,"internal-error");const h="object"==typeof c.firebase?c.firebase:void 0,l=null==h?void 0:h.sign_in_provider;return{claims:c,token:r,authTime:J(X(c.auth_time)),issuedAtTime:J(X(c.iat)),expirationTime:J(X(c.exp)),signInProvider:l||null,signInSecondFactor:(null==h?void 0:h.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Object(o.n)(e);await re(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(C(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ae(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){C(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await re(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Object(r.c)(this.auth.app))return Promise.reject(E(this.auth));const e=await this.getIdToken();return await ee(this,async function(e,t){return V(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,object){var t,n,r,o,c,h,l,d;const f=null!==(t=object.displayName)&&void 0!==t?t:void 0,m=null!==(n=object.email)&&void 0!==n?n:void 0,y=null!==(r=object.phoneNumber)&&void 0!==r?r:void 0,v=null!==(o=object.photoURL)&&void 0!==o?o:void 0,w=null!==(c=object.tenantId)&&void 0!==c?c:void 0,_=null!==(h=object._redirectEventId)&&void 0!==h?h:void 0,T=null!==(l=object.createdAt)&&void 0!==l?l:void 0,E=null!==(d=object.lastLoginAt)&&void 0!==d?d:void 0,{uid:I,emailVerified:S,isAnonymous:k,providerData:A,stsTokenManager:N}=object;C(I&&N,e,"internal-error");const R=se.fromJSON(this.name,N);C("string"==typeof I,e,"internal-error"),oe(f,e.name),oe(m,e.name),C("boolean"==typeof S,e,"internal-error"),C("boolean"==typeof k,e,"internal-error"),oe(y,e.name),oe(v,e.name),oe(w,e.name),oe(_,e.name),oe(T,e.name),oe(E,e.name);const O=new ae({uid:I,auth:e,email:m,emailVerified:S,displayName:f,isAnonymous:k,photoURL:v,phoneNumber:y,tenantId:w,stsTokenManager:R,createdAt:T,lastLoginAt:E});return A&&Array.isArray(A)&&(O.providerData=A.map((e=>Object.assign({},e)))),_&&(O._redirectEventId=_),O}static async _fromIdTokenResponse(e,t,n=!1){const r=new se;r.updateFromServerResponse(t);const o=new ae({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await re(o),o}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];C(void 0!==r.localId,"internal-error");const o=void 0!==r.providerUserInfo?ie(r.providerUserInfo):[],c=!(r.email&&r.passwordHash||(null==o?void 0:o.length)),h=new se;h.updateFromIdToken(n);const l=new ae({uid:r.localId,auth:e,stsTokenManager:h,isAnonymous:c}),d={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new ne(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash||(null==o?void 0:o.length))};return Object.assign(l,d),l}}const ce=new Map;function ue(e){A(e instanceof Function,"Expected a class definition");let t=ce.get(e);return t?(A(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,ce.set(e,t),t)}class he{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}he.type="NONE";const le=he;function de(e,t,n){return`firebase:${e}:${t}:${n}`}class fe{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:o}=this.auth;this.fullUserKey=de(this.userKey,r.apiKey,o),this.fullPersistenceKey=de("persistence",r.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ae._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new fe(ue(le),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let o=r[0]||ue(le);const c=de(n,e.config.apiKey,e.name);let h=null;for(const n of t)try{const t=await n._get(c);if(t){const r=ae._fromJSON(e,t);n!==o&&(h=r),o=n;break}}catch(e){}const l=r.filter((p=>p._shouldAllowMigration));return o._shouldAllowMigration&&l.length?(o=l[0],h&&await o._set(c,h.toJSON()),await Promise.all(t.map((async e=>{if(e!==o)try{await e._remove(c)}catch(e){}}))),new fe(o,e,n)):new fe(o,e,n)}}function pe(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ve(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ge(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(_e(t))return"Blackberry";if(Te(t))return"Webos";if(me(t))return"Safari";if((t.includes("chrome/")||ye(t))&&!t.includes("edge/"))return"Chrome";if(we(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function ge(e=Object(o.o)()){return/firefox\//i.test(e)}function me(e=Object(o.o)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ye(e=Object(o.o)()){return/crios\//i.test(e)}function ve(e=Object(o.o)()){return/iemobile/i.test(e)}function we(e=Object(o.o)()){return/android/i.test(e)}function _e(e=Object(o.o)()){return/blackberry/i.test(e)}function Te(e=Object(o.o)()){return/webos/i.test(e)}function Ee(e=Object(o.o)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Ie(e=Object(o.o)()){return Ee(e)||we(e)||Te(e)||_e(e)||/windows phone/i.test(e)||ve(e)}function be(e,t=[]){let n;switch(e){case"Browser":n=pe(Object(o.o)());break;case"Worker":n=`${pe(Object(o.o)())}-${e}`;break;default:n=e}const c=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${r.a}/${c}`}class Se{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Ce{constructor(e){var t,n,r,o;const c=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=c.minPasswordLength)&&void 0!==t?t:6,c.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=c.maxPasswordLength),void 0!==c.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=c.containsLowercaseCharacter),void 0!==c.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=c.containsUppercaseCharacter),void 0!==c.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=c.containsNumericCharacter),void 0!==c.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=c.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(o=e.forceUpgradeOnSignin)&&void 0!==o&&o,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,o,c,h;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=null===(t=l.meetsMinPasswordLength)||void 0===t||t),l.isValid&&(l.isValid=null===(n=l.meetsMaxPasswordLength)||void 0===n||n),l.isValid&&(l.isValid=null===(r=l.containsLowercaseLetter)||void 0===r||r),l.isValid&&(l.isValid=null===(o=l.containsUppercaseLetter)||void 0===o||o),l.isValid&&(l.isValid=null===(c=l.containsNumericCharacter)||void 0===c||c),l.isValid&&(l.isValid=null===(h=l.containsNonAlphanumericCharacter)||void 0===h||h),l}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class ke{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ne(this),this.idTokenSubscription=new Ne(this),this.beforeStateQueue=new Se(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=m,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ue(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await fe.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Q(this,{idToken:e}),n=await ae._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Object(r.c)(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let o=n,c=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,r=null==o?void 0:o._redirectEventId,h=await this.tryRedirectSignIn(e);n&&n!==r||!(null==h?void 0:h.user)||(o=h.user,c=!0)}if(!o)return this.directlySetCurrentUser(null);if(!o._redirectEventId){if(c)try{await this.beforeStateQueue.runMiddleware(o)}catch(e){o=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return o?this.reloadAndSetCurrentUserOrClear(o):this.directlySetCurrentUser(null)}return C(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===o._redirectEventId?this.directlySetCurrentUser(o):this.reloadAndSetCurrentUserOrClear(o)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await re(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Object(r.c)(this.app))return Promise.reject(E(this));const t=e?Object(o.n)(e):null;return t&&C(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&C(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return Object(r.c)(this.app)?Promise.reject(E(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Object(r.c)(this.app)?Promise.reject(E(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(ue(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return V(e,"GET","/v2/passwordPolicy",U(e,t))}(this),t=new Ce(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new o.b("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return V(e,"POST","/v2/accounts:revokeToken",U(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ue(e)||this._popupRedirectResolver;C(t,this,"argument-error"),this.redirectPersistenceManager=await fe.create(this,[ue(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const o="function"==typeof t?t:t.next.bind(t);let c=!1;const h=this._isInitialized?Promise.resolve():this._initializationPromise;if(C(h,this,"internal-error"),h.then((()=>{c||o(this.currentUser)})),"function"==typeof t){const o=e.addObserver(t,n,r);return()=>{c=!0,o()}}{const n=e.addObserver(t);return()=>{c=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return C(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=be(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){y.logLevel<=c.a.WARN&&y.warn(`Auth (${r.a}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Ae(e){return Object(o.n)(e)}class Ne{constructor(e){this.auth=e,this.observer=null,this.addObserver=Object(o.g)((e=>this.observer=e))}get next(){return C(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Re={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Oe(e){return Re.loadJS(e)}function De(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Pe{constructor(e){this.type="recaptcha-enterprise",this.auth=Ae(e)}async verify(e="verify",t=!1){function n(t,n,r){const o=window.grecaptcha;G(o)?o.enterprise.ready((()=>{o.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{W(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new H(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((o=>{if(!t&&G(window.grecaptcha))n(o,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Re.recaptchaEnterpriseScript;0!==t.length&&(t+=o),Oe(t).then((()=>{n(o,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function Le(e,t,n,r=!1){const o=new Pe(e);let c;try{c=await o.verify(n)}catch(e){c=await o.verify(n,!0)}const h=Object.assign({},t);return r?Object.assign(h,{captchaResp:c}):Object.assign(h,{captchaResponse:c}),Object.assign(h,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(h,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),h}async function xe(e,t,n,r){var o;if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await Le(e,t,n,"getOobCode"===n);return r(e,o)}return r(e,t).catch((async o=>{if("auth/missing-recaptcha-token"===o.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Le(e,t,n,"getOobCode"===n);return r(e,o)}return Promise.reject(o)}))}function Me(e,t,n){const r=Ae(e);C(r._canInitEmulator,r,"emulator-config-failed"),C(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const o=!!(null==n?void 0:n.disableWarnings),c=Ue(t),{host:h,port:l}=function(e){const t=Ue(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",o=/^(\[[^\]]+\])(:|$)/.exec(r);if(o){const e=o[1];return{host:e,port:Ve(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Ve(t)}}}(t),d=null===l?"":`:${l}`;r.config.emulator={url:`${c}//${h}${d}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:h,port:l,protocol:c.replace(":",""),options:Object.freeze({disableWarnings:o})}),o||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Ue(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Ve(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Fe{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return k("not implemented")}_getIdTokenResponse(e){return k("not implemented")}_linkToIdToken(e,t){return k("not implemented")}_getReauthenticationResolver(e){return k("not implemented")}}async function je(e,t){return V(e,"POST","/v1/accounts:signUp",t)}async function qe(e,t){return j(e,"POST","/v1/accounts:signInWithPassword",U(e,t))}class Be extends Fe{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Be(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Be(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return xe(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",qe);case"emailLink":return async function(e,t){return j(e,"POST","/v1/accounts:signInWithEmailLink",U(e,t))}(e,{email:this._email,oobCode:this._password});default:w(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return xe(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",je);case"emailLink":return async function(e,t){return j(e,"POST","/v1/accounts:signInWithEmailLink",U(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:w(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Ke(e,t){return j(e,"POST","/v1/accounts:signInWithIdp",U(e,t))}class ze extends Fe{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ze(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):w("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,o=h(t,["providerId","signInMethod"]);if(!n||!r)return null;const c=new ze(n,r);return c.idToken=o.idToken||void 0,c.accessToken=o.accessToken||void 0,c.secret=o.secret,c.nonce=o.nonce,c.pendingToken=o.pendingToken||null,c}_getIdTokenResponse(e){return Ke(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ke(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ke(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Object(o.x)(t)}return e}}const $e={USER_NOT_FOUND:"user-not-found"};class Ge extends Fe{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Ge({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Ge({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return j(e,"POST","/v1/accounts:signInWithPhoneNumber",U(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await j(e,"POST","/v1/accounts:signInWithPhoneNumber",U(e,t));if(n.temporaryProof)throw $(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return j(e,"POST","/v1/accounts:signInWithPhoneNumber",U(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),$e)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:o}=e;return n||t||r||o?new Ge({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:o}):null}}class He{constructor(e){var t,n,r,c,h,l;const d=Object(o.y)(Object(o.i)(e)),f=null!==(t=d.apiKey)&&void 0!==t?t:null,code=null!==(n=d.oobCode)&&void 0!==n?n:null,m=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=d.mode)&&void 0!==r?r:null);C(f&&code&&m,"argument-error"),this.apiKey=f,this.operation=m,this.code=code,this.continueUrl=null!==(c=d.continueUrl)&&void 0!==c?c:null,this.languageCode=null!==(h=d.languageCode)&&void 0!==h?h:null,this.tenantId=null!==(l=d.tenantId)&&void 0!==l?l:null}static parseLink(link){const e=function(e){const link=Object(o.y)(Object(o.i)(e)).link,t=link?Object(o.y)(Object(o.i)(link)).deep_link_id:null,n=Object(o.y)(Object(o.i)(e)).deep_link_id;return(n?Object(o.y)(Object(o.i)(n)).link:null)||n||t||link||e}(link);try{return new He(e)}catch(e){return null}}}class We{constructor(){this.providerId=We.PROVIDER_ID}static credential(e,t){return Be._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=He.parseLink(t);return C(n,"argument-error"),Be._fromEmailAndCode(e,n.code,n.tenantId)}}We.PROVIDER_ID="password",We.EMAIL_PASSWORD_SIGN_IN_METHOD="password",We.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Qe{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Je extends Qe{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Xe extends Je{constructor(){super("facebook.com")}static credential(e){return ze._fromParams({providerId:Xe.PROVIDER_ID,signInMethod:Xe.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xe.credentialFromTaggedObject(e)}static credentialFromError(e){return Xe.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Xe.credential(e.oauthAccessToken)}catch(e){return null}}}Xe.FACEBOOK_SIGN_IN_METHOD="facebook.com",Xe.PROVIDER_ID="facebook.com";class Ye extends Je{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ze._fromParams({providerId:Ye.PROVIDER_ID,signInMethod:Ye.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ye.credentialFromTaggedObject(e)}static credentialFromError(e){return Ye.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Ye.credential(t,n)}catch(e){return null}}}Ye.GOOGLE_SIGN_IN_METHOD="google.com",Ye.PROVIDER_ID="google.com";class Ze extends Je{constructor(){super("github.com")}static credential(e){return ze._fromParams({providerId:Ze.PROVIDER_ID,signInMethod:Ze.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ze.credentialFromTaggedObject(e)}static credentialFromError(e){return Ze.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ze.credential(e.oauthAccessToken)}catch(e){return null}}}Ze.GITHUB_SIGN_IN_METHOD="github.com",Ze.PROVIDER_ID="github.com";class et extends Je{constructor(){super("twitter.com")}static credential(e,t){return ze._fromParams({providerId:et.PROVIDER_ID,signInMethod:et.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return et.credentialFromTaggedObject(e)}static credentialFromError(e){return et.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return et.credential(t,n)}catch(e){return null}}}et.TWITTER_SIGN_IN_METHOD="twitter.com",et.PROVIDER_ID="twitter.com";class tt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const o=await ae._fromIdTokenResponse(e,n,r),c=nt(n);return new tt({user:o,providerId:c,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=nt(n);return new tt({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function nt(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class it extends o.c{constructor(e,t,n,r){var o;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,it.prototype),this.customData={appName:e.name,tenantId:null!==(o=e.tenantId)&&void 0!==o?o:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new it(e,t,n,r)}}function st(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw it._fromErrorAndOperation(e,n,t,r);throw n}))}async function ot(e,t,n=!1){const r=await ee(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return tt._forOperation(e,"link",r)}async function at(e,t,n=!1){const{auth:o}=e;if(Object(r.c)(o.app))return Promise.reject(E(o));const c="reauthenticate";try{const r=await ee(e,st(o,c,t,e),n);C(r.idToken,o,"internal-error");const h=Y(r.idToken);C(h,o,"internal-error");const{sub:l}=h;return C(e.uid===l,o,"user-mismatch"),tt._forOperation(e,c,r)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&w(o,"user-mismatch"),e}}async function ct(e,t,n=!1){if(Object(r.c)(e.app))return Promise.reject(E(e));const o="signIn",c=await st(e,o,t),h=await tt._fromIdTokenResponse(e,o,c);return n||await e._updateCurrentUser(h.user),h}function ut(e,t,n,r){return Object(o.n)(e).onAuthStateChanged(t,n,r)}new WeakMap;const ht="__sak";class lt{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ht,"1"),this.storage.removeItem(ht),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class ft extends lt{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=Object(o.o)();return me(e)||Ee(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Ie(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},c=this.storage.getItem(n);Object(o.s)()&&10===document.documentMode&&c!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ft.type="LOCAL";const pt=ft;class gt extends lt{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}gt.type="SESSION";const mt=gt;class yt{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new yt(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:data}=t.data,o=this.handlersMap[r];if(!(null==o?void 0:o.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const c=Array.from(o).map((async e=>e(t.origin,data))),h=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(c);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:h})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function vt(e="",t=10){let n="";for(let i=0;i<t;i++)n+=Math.floor(10*Math.random());return e+n}yt.receivers=[];class wt{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,data,t=50){const n="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let r,o;return new Promise(((c,h)=>{const l=vt("",20);n.port1.start();const d=setTimeout((()=>{h(new Error("unsupported_event"))}),t);o={messageChannel:n,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(d),r=setTimeout((()=>{h(new Error("timeout"))}),3e3);break;case"done":clearTimeout(r),c(t.data.response);break;default:clearTimeout(d),clearTimeout(r),h(new Error("invalid_response"))}}},this.handlers.add(o),n.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:l,data:data},[n.port2])})).finally((()=>{o&&this.removeMessageHandler(o)}))}}function _t(){return window}function Tt(){return void 0!==_t().WorkerGlobalScope&&"function"==typeof _t().importScripts}const Et="firebaseLocalStorageDb",It="firebaseLocalStorage",bt="fbase_key";class St{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Ct(e,t){return e.transaction([It],t?"readwrite":"readonly").objectStore(It)}function kt(){const e=indexedDB.open(Et,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(It,{keyPath:bt})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(It)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Et);return new St(e).toPromise()}(),t(await kt()))}))}))}async function At(e,t,n){const r=Ct(e,!0).put({[bt]:t,value:n});return new St(r).toPromise()}function Nt(e,t){const n=Ct(e,!0).delete(t);return new St(n).toPromise()}class Rt{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await kt()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Tt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=yt._getInstance(Tt()?self:null),this.receiver._subscribe("keyChanged",(async(e,data)=>({keyProcessed:(await this._poll()).includes(data.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new wt(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await kt();return await At(e,ht,"1"),await Nt(e,ht),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>At(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Ct(e,!1).get(t),data=await new St(n).toPromise();return void 0===data?null:data.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Nt(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Ct(e,!1).getAll();return new St(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:o}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(o)&&(this.notifyListeners(r,o),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Rt.type="LOCAL";const Ot=Rt;De("rcb"),new D(3e4,6e4);const Dt="recaptcha";async function Pt(e,t,n){var r;const o=await n.verify();try{let c;if(C("string"==typeof o,e,"argument-error"),C(n.type===Dt,e,"argument-error"),c="string"==typeof t?{phoneNumber:t}:t,"session"in c){const t=c.session;if("phoneNumber"in c){C("enroll"===t.type,e,"internal-error");const n=await function(e,t){return V(e,"POST","/v2/accounts/mfaEnrollment:start",U(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:c.phoneNumber,recaptchaToken:o}});return n.phoneSessionInfo.sessionInfo}{C("signin"===t.type,e,"internal-error");const n=(null===(r=c.multiFactorHint)||void 0===r?void 0:r.uid)||c.multiFactorUid;C(n,e,"missing-multi-factor-info");const h=await function(e,t){return V(e,"POST","/v2/accounts/mfaSignIn:start",U(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:o}});return h.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return V(e,"POST","/v1/accounts:sendVerificationCode",U(e,t))}(e,{phoneNumber:c.phoneNumber,recaptchaToken:o});return t}}finally{n._reset()}}class Lt{constructor(e){this.providerId=Lt.PROVIDER_ID,this.auth=Ae(e)}verifyPhoneNumber(e,t){return Pt(this.auth,e,Object(o.n)(t))}static credential(e,t){return Ge._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Lt.credentialFromTaggedObject(t)}static credentialFromError(e){return Lt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Ge._fromTokenResponse(t,n):null}}function xt(e,t){return t?ue(t):(C(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Lt.PROVIDER_ID="phone",Lt.PHONE_SIGN_IN_METHOD="phone";class Mt extends Fe{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ke(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ke(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ke(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Ut(e){return ct(e.auth,new Mt(e),e.bypassAuthState)}function Vt(e){const{auth:t,user:n}=e;return C(n,t,"internal-error"),at(n,new Mt(e),e.bypassAuthState)}async function Ft(e){const{auth:t,user:n}=e;return C(n,t,"internal-error"),ot(n,new Mt(e),e.bypassAuthState)}class jt{constructor(e,filter,t,n,r=!1){this.auth=e,this.resolver=t,this.user=n,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(filter)?filter:[filter]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:o,error:c,type:h}=e;if(c)return void this.reject(c);const l={auth:this.auth,requestUri:t,sessionId:n,tenantId:o||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(h)(l))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Ut;case"linkViaPopup":case"linkViaRedirect":return Ft;case"reauthViaPopup":case"reauthViaRedirect":return Vt;default:w(this.auth,"internal-error")}}resolve(e){A(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){A(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const qt=new D(2e3,1e4);async function Bt(e,t,n){if(Object(r.c)(e.app))return Promise.reject(_(e,"operation-not-supported-in-this-environment"));const o=Ae(e);I(e,t,Qe);const c=xt(o,n);return new Kt(o,"signInViaPopup",t,c).executeNotNull()}class Kt extends jt{constructor(e,filter,t,n,r){super(e,filter,n,r),this.provider=t,this.authWindow=null,this.pollId=null,Kt.currentPopupAction&&Kt.currentPopupAction.cancel(),Kt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return C(e,this.auth,"internal-error"),e}async onExecution(){A(1===this.filter.length,"Popup operations only handle one event");const e=vt();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(_(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(_(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Kt.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(_(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,qt.get())};e()}}Kt.currentPopupAction=null;const zt="pendingRedirect",$t=new Map;class Gt extends jt{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=$t.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Qt(t),r=Wt(e);if(!await r._isAvailable())return!1;const o="true"===await r._get(n);return await r._remove(n),o}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}$t.set(this.auth._key(),e)}return this.bypassAuthState||$t.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Ht(e,t){$t.set(e._key(),t)}function Wt(e){return ue(e._redirectPersistence)}function Qt(e){return de(zt,e.config.apiKey,e.name)}async function Jt(e,t,n=!1){if(Object(r.c)(e.app))return Promise.reject(E(e));const o=Ae(e),c=xt(o,t),h=new Gt(o,c,n),l=await h.execute();return l&&!n&&(delete l.user._redirectEventId,await o._persistUserIfCurrent(l.user),await o._setRedirectUser(null,t)),l}class Xt{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Zt(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Zt(e)){const code=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(_(this.auth,code))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Yt(e))}saveEventToCache(e){this.cachedEventUids.add(Yt(e)),this.lastProcessedEventTime=Date.now()}}function Yt(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Zt({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const en=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,tn=/^https?/;async function nn(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return V(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(rn(e))return}catch(e){}w(e,"unauthorized-domain")}function rn(e){const t=N(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const o=new URL(e);return""===o.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&o.hostname===r}if(!tn.test(n))return!1;if(en.test(e))return r===e;const o=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+o+"|"+o+")$","i").test(r)}const sn=new D(3e4,6e4);function on(){const e=_t().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let i=0;i<e.CP.length;i++)e.CP[i]=null}function an(e){return new Promise(((t,n)=>{var r,o,c;function h(){on(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{on(),n(_(e,"network-request-failed"))},timeout:sn.get()})}if(null===(o=null===(r=_t().gapi)||void 0===r?void 0:r.iframes)||void 0===o?void 0:o.Iframe)t(gapi.iframes.getContext());else{if(!(null===(c=_t().gapi)||void 0===c?void 0:c.load)){const t=De("iframefcb");return _t()[t]=()=>{gapi.load?h():n(_(e,"network-request-failed"))},Oe(`${Re.gapiScript}?onload=${t}`).catch((e=>n(e)))}h()}})).catch((e=>{throw cn=null,e}))}let cn=null;const un=new D(5e3,15e3),hn="__/auth/iframe",ln="emulator/auth/iframe",dn={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},fn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function pn(e){const t=e.config;C(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?P(t,ln):`https://${e.config.authDomain}/${hn}`,c={apiKey:t.apiKey,appName:e.name,v:r.a},h=fn.get(e.config.apiHost);h&&(c.eid=h);const l=e._getFrameworks();return l.length&&(c.fw=l.join(",")),`${n}?${Object(o.x)(c).slice(1)}`}async function gn(e){const t=await function(e){return cn=cn||an(e),cn}(e),n=_t().gapi;return C(n,e,"internal-error"),t.open({where:document.body,url:pn(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:dn,dontclear:!0},(iframe=>new Promise((async(t,n)=>{await iframe.restyle({setHideOnLeave:!1});const r=_(e,"network-request-failed"),o=_t().setTimeout((()=>{n(r)}),un.get());function c(){_t().clearTimeout(o),t(iframe)}iframe.ping(c).then(c,(()=>{n(r)}))}))))}const mn={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class yn{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function vn(e,t,n,r=500,c=600){const h=Math.max((window.screen.availHeight-c)/2,0).toString(),l=Math.max((window.screen.availWidth-r)/2,0).toString();let d="";const f=Object.assign(Object.assign({},mn),{width:r.toString(),height:c.toString(),top:h,left:l}),m=Object(o.o)().toLowerCase();n&&(d=ye(m)?"_blank":n),ge(m)&&(t=t||"http://localhost",f.scrollbars="yes");const y=Object.entries(f).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=Object(o.o)()){var t;return Ee(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(m)&&"_self"!==d)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",d),new yn(null);const v=window.open(t||"",d,y);C(v,e,"popup-blocked");try{v.focus()}catch(e){}return new yn(v)}const wn="__/auth/handler",_n="emulator/auth/handler",Tn=encodeURIComponent("fac");async function En(e,t,n,c,h,l){C(e.config.authDomain,e,"auth-domain-config-required"),C(e.config.apiKey,e,"invalid-api-key");const d={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:c,v:r.a,eventId:h};if(t instanceof Qe){t.setDefaultLanguage(e.languageCode),d.providerId=t.providerId||"",Object(o.r)(t.getCustomParameters())||(d.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(l||{}))d[e]=t}if(t instanceof Je){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(d.scopes=e.join(","))}e.tenantId&&(d.tid=e.tenantId);const f=d;for(const e of Object.keys(f))void 0===f[e]&&delete f[e];const m=await e._getAppCheckToken(),y=m?`#${Tn}=${encodeURIComponent(m)}`:"";return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${wn}`;return P(e,_n)}(e)}?${Object(o.x)(f).slice(1)}${y}`}const In="webStorageSupport";const bn=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=mt,this._completeRedirectFn=Jt,this._overrideRedirectResult=Ht}async _openPopup(e,t,n,r){var o;A(null===(o=this.eventManagers[e._key()])||void 0===o?void 0:o.manager,"_initialize() not called before _openPopup()");return vn(e,await En(e,t,n,N(),r),vt())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){_t().location.href=e}(await En(e,t,n,N(),r)),new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(A(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const iframe=await gn(e),t=new Xt(e);return iframe.register("authEvent",(n=>{C(null==n?void 0:n.authEvent,e,"invalid-auth-event");return{status:t.onEvent(n.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:t},this.iframes[e._key()]=iframe,t}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(In,{type:In},(n=>{var r;const o=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[In];void 0!==o&&t(!!o),w(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=nn(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ie()||me()||Ee()}};var Sn="@firebase/auth",Cn="1.7.0";class kn{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){C(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const An=Object(o.m)("authIdTokenMaxAge")||300;let Nn=null;const Rn=e=>async t=>{const n=t&&await t.getIdTokenResult(),r=n&&((new Date).getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>An)return;const o=null==n?void 0:n.token;Nn!==o&&(Nn=o,await fetch(e,{method:o?"POST":"DELETE",headers:o?{Authorization:`Bearer ${o}`}:{}}))};function On(e=Object(r.f)()){const t=Object(r.b)(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=Object(r.b)(e,"auth");if(n.isInitialized()){const e=n.getImmediate(),r=n.getOptions();if(Object(o.h)(r,null!=t?t:{}))return e;w(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:bn,persistence:[Ot,pt,mt]}),c=Object(o.m)("authTokenSyncURL");if(c&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(c,location.origin);if(location.origin===e.origin){const t=Rn(e.toString());!function(e,t,n){Object(o.n)(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e,t,n,r){Object(o.n)(e).onIdTokenChanged(t,n,r)}(n,(e=>t(e)))}}const h=Object(o.k)("auth");return h&&Me(n,`http://${h}`),n}var Dn;Re={loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");var o,c;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=_("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(c=null===(o=document.getElementsByTagName("head"))||void 0===o?void 0:o[0])&&void 0!==c?c:document).appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Dn="Browser",Object(r.d)(new l.a("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:c,authDomain:h}=n.options;C(c&&!c.includes(":"),"invalid-api-key",{appName:n.name});const l={apiKey:c,authDomain:h,clientPlatform:Dn,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:be(Dn)},d=new ke(n,r,o,l);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(ue);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(d,t),d}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),Object(r.d)(new l.a("auth-internal",(e=>(e=>new kn(e))(Ae(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),Object(r.h)(Sn,Cn,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Dn)),Object(r.h)(Sn,Cn,"esm2017")},361:function(e,t,n){"use strict";var r=n(352);n.d(t,"a",(function(){return r.a})),n.d(t,"b",(function(){return r.b})),n.d(t,"c",(function(){return r.c})),n.d(t,"d",(function(){return r.d}))},362:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return Er})),n.d(t,"b",(function(){return Sr})),n.d(t,"c",(function(){return Ir})),n.d(t,"d",(function(){return Rr})),n.d(t,"e",(function(){return Nr})),n.d(t,"f",(function(){return Cr})),n.d(t,"g",(function(){return kr})),n.d(t,"h",(function(){return Ar})),n.d(t,"i",(function(){return _r})),n.d(t,"j",(function(){return Tr}));var r,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},c={},h=h||{},l=o||self;function d(a){var b=typeof a;return"array"==(b="object"!=b?b:a?Array.isArray(a)?"array":b:"null")||"object"==b&&"number"==typeof a.length}function p(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var f="closure_uid_"+(1e9*Math.random()>>>0),m=0;function y(a,b,e){return a.call.apply(a.bind,arguments)}function v(a,b,e){if(!a)throw Error();if(2<arguments.length){var t=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,t),a.apply(b,e)}}return function(){return a.apply(b,arguments)}}function q(a,b,e){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:v).apply(null,arguments)}function w(a,b){var e=Array.prototype.slice.call(arguments,1);return function(){var t=e.slice();return t.push.apply(t,arguments),a.apply(this,t)}}function _(a,b){function e(){}e.prototype=b.prototype,a.$=b.prototype,a.prototype=new e,a.prototype.constructor=a,a.ac=function(e,t,n){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return b.prototype[t].apply(e,r)}}function T(){this.s=this.s,this.o=this.o}T.prototype.s=!1,T.prototype.sa=function(){var a;!this.s&&(this.s=!0,this.N(),0)&&(a=this,Object.prototype.hasOwnProperty.call(a,f)&&a[f]||(a[f]=++m))},T.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const E=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"==typeof a)return"string"!=typeof b||1!=b.length?-1:a.indexOf(b,0);for(let e=0;e<a.length;e++)if(e in a&&a[e]===b)return e;return-1};function I(a){const b=a.length;if(0<b){const e=Array(b);for(let t=0;t<b;t++)e[t]=a[t];return e}return[]}function S(a,b){for(let e=1;e<arguments.length;e++){const t=arguments[e];if(d(t)){const e=a.length||0,n=t.length||0;a.length=e+n;for(let r=0;r<n;r++)a[e+r]=t[r]}else a.push(t)}}function C(a,b){this.type=a,this.g=this.target=b,this.defaultPrevented=!1}C.prototype.h=function(){this.defaultPrevented=!0};var k=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const e=()=>{};l.addEventListener("test",e,b),l.removeEventListener("test",e,b)}catch(e){}return a}();function A(a){return/^[\s\xa0]*$/.test(a)}function N(){var a=l.navigator;return a&&(a=a.userAgent)?a:""}function R(a){return-1!=N().indexOf(a)}function O(a){return O[" "](a),a}O[" "]=function(){};var D,a,P,L=R("Opera"),x=R("Trident")||R("MSIE"),M=R("Edge"),U=M||x,V=R("Gecko")&&!(-1!=N().toLowerCase().indexOf("webkit")&&!R("Edge"))&&!(R("Trident")||R("MSIE"))&&!R("Edge"),F=-1!=N().toLowerCase().indexOf("webkit")&&!R("Edge");function j(){var a=l.document;return a?a.documentMode:void 0}e:{var B="",K=(a=N(),V?/rv:([^\);]+)(\)|;)/.exec(a):M?/Edge\/([\d\.]+)/.exec(a):x?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):F?/WebKit\/(\S+)/.exec(a):L?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if(K&&(B=K?K[1]:""),x){var z=j();if(null!=z&&z>parseFloat(B)){D=String(z);break e}}D=B}if(l.document&&x){var $=j();P=$||(parseInt(D,10)||void 0)}else P=void 0;var G=P;function H(a,b){if(C.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var e=this.type=a.type,t=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=b,b=a.relatedTarget){if(V){e:{try{O(b.nodeName);var n=!0;break e}catch(e){}n=!1}n||(b=null)}}else"mouseover"==e?b=a.fromElement:"mouseout"==e&&(b=a.toElement);this.relatedTarget=b,t?(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:W[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&H.$.h.call(this)}}_(H,C);var W={2:"touch",3:"pen",4:"mouse"};H.prototype.h=function(){H.$.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Q="closure_listenable_"+(1e6*Math.random()|0),J=0;function X(a,b,e,t,n){this.listener=a,this.proxy=null,this.src=b,this.type=e,this.capture=!!t,this.la=n,this.key=++J,this.fa=this.ia=!1}function Y(a){a.fa=!0,a.listener=null,a.proxy=null,a.src=null,a.la=null}function Z(a,b,e){for(const t in a)b.call(e,a[t],t,a)}function ee(a){const b={};for(const e in a)b[e]=a[e];return b}const te="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ne(a,b){let e,t;for(let n=1;n<arguments.length;n++){for(e in t=arguments[n],t)a[e]=t[e];for(let n=0;n<te.length;n++)e=te[n],Object.prototype.hasOwnProperty.call(t,e)&&(a[e]=t[e])}}function re(a){this.src=a,this.g={},this.h=0}function ie(a,b){var e=b.type;if(e in a.g){var t,n=a.g[e],r=E(n,b);(t=0<=r)&&Array.prototype.splice.call(n,r,1),t&&(Y(b),0==a.g[e].length&&(delete a.g[e],a.h--))}}function se(a,b,e,t){for(var n=0;n<a.length;++n){var r=a[n];if(!r.fa&&r.listener==b&&r.capture==!!e&&r.la==t)return n}return-1}re.prototype.add=function(a,b,e,t,n){var r=a.toString();(a=this.g[r])||(a=this.g[r]=[],this.h++);var o=se(a,b,t,n);return-1<o?(b=a[o],e||(b.ia=!1)):((b=new X(b,this.src,r,!!t,n)).ia=e,a.push(b)),b};var oe="closure_lm_"+(1e6*Math.random()|0),ae={};function ce(a,b,e,t,n){if(t&&t.once)return he(a,b,e,t,n);if(Array.isArray(b)){for(var r=0;r<b.length;r++)ce(a,b[r],e,t,n);return null}return e=ye(e),a&&a[Q]?a.O(b,e,p(t)?!!t.capture:!!t,n):ue(a,b,e,!1,t,n)}function ue(a,b,e,t,n,r){if(!b)throw Error("Invalid event type");var o=p(n)?!!n.capture:!!n,c=ge(a);if(c||(a[oe]=c=new re(a)),(e=c.add(b,e,t,o,r)).proxy)return e;if(t=function(){function a(e){return b.call(a.src,a.listener,e)}const b=pe;return a}(),e.proxy=t,t.src=a,t.listener=e,a.addEventListener)k||(n=o),void 0===n&&(n=!1),a.addEventListener(b.toString(),t,n);else if(a.attachEvent)a.attachEvent(fe(b.toString()),t);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(t)}return e}function he(a,b,e,t,n){if(Array.isArray(b)){for(var r=0;r<b.length;r++)he(a,b[r],e,t,n);return null}return e=ye(e),a&&a[Q]?a.P(b,e,p(t)?!!t.capture:!!t,n):ue(a,b,e,!0,t,n)}function le(a,b,e,t,n){if(Array.isArray(b))for(var r=0;r<b.length;r++)le(a,b[r],e,t,n);else t=p(t)?!!t.capture:!!t,e=ye(e),a&&a[Q]?(a=a.i,(b=String(b).toString())in a.g&&(-1<(e=se(r=a.g[b],e,t,n))&&(Y(r[e]),Array.prototype.splice.call(r,e,1),0==r.length&&(delete a.g[b],a.h--)))):a&&(a=ge(a))&&(b=a.g[b.toString()],a=-1,b&&(a=se(b,e,t,n)),(e=-1<a?b[a]:null)&&de(e))}function de(a){if("number"!=typeof a&&a&&!a.fa){var b=a.src;if(b&&b[Q])ie(b.i,a);else{var e=a.type,t=a.proxy;b.removeEventListener?b.removeEventListener(e,t,a.capture):b.detachEvent?b.detachEvent(fe(e),t):b.addListener&&b.removeListener&&b.removeListener(t),(e=ge(b))?(ie(e,a),0==e.h&&(e.src=null,b[oe]=null)):Y(a)}}}function fe(a){return a in ae?ae[a]:ae[a]="on"+a}function pe(a,b){if(a.fa)a=!0;else{b=new H(b,this);var e=a.listener,t=a.la||a.src;a.ia&&de(a),a=e.call(t,b)}return a}function ge(a){return(a=a[oe])instanceof re?a:null}var me="__closure_events_fn_"+(1e9*Math.random()>>>0);function ye(a){return"function"==typeof a?a:(a[me]||(a[me]=function(b){return a.handleEvent(b)}),a[me])}function ve(){T.call(this),this.i=new re(this),this.S=this,this.J=null}function we(a,b){var e,t=a.J;if(t)for(e=[];t;t=t.J)e.push(t);if(a=a.S,t=b.type||b,"string"==typeof b)b=new C(b,a);else if(b instanceof C)b.target=b.target||a;else{var n=b;ne(b=new C(t,a),n)}if(n=!0,e)for(var r=e.length-1;0<=r;r--){var o=b.g=e[r];n=_e(o,t,!0,b)&&n}if(n=_e(o=b.g=a,t,!0,b)&&n,n=_e(o,t,!1,b)&&n,e)for(r=0;r<e.length;r++)n=_e(o=b.g=e[r],t,!1,b)&&n}function _e(a,b,e,t){if(!(b=a.i.g[String(b)]))return!0;b=b.concat();for(var n=!0,r=0;r<b.length;++r){var o=b[r];if(o&&!o.fa&&o.capture==e){var c=o.listener,h=o.la||o.src;o.ia&&ie(a.i,o),n=!1!==c.call(h,t)&&n}}return n&&!t.defaultPrevented}_(ve,T),ve.prototype[Q]=!0,ve.prototype.removeEventListener=function(a,b,e,t){le(this,a,b,e,t)},ve.prototype.N=function(){if(ve.$.N.call(this),this.i){var e,a=this.i;for(e in a.g){for(var t=a.g[e],n=0;n<t.length;n++)Y(t[n]);delete a.g[e],a.h--}}this.J=null},ve.prototype.O=function(a,b,e,t){return this.i.add(String(a),b,!1,e,t)},ve.prototype.P=function(a,b,e,t){return this.i.add(String(a),b,!0,e,t)};var Te=l.JSON.stringify;function Ee(){var a=Ne;let b=null;return a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null),b}var Ie=new class{constructor(a,b){this.i=a,this.j=b,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}((()=>new be),(a=>a.reset()));class be{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}function Se(a){var b=1;a=a.split(":");const e=[];for(;0<b&&a.length;)e.push(a.shift()),b--;return a.length&&e.push(a.join(":")),e}function Ce(a){l.setTimeout((()=>{throw a}),0)}let ke,Ae=!1,Ne=new class{constructor(){this.h=this.g=null}add(a,b){const e=Ie.get();e.set(a,b),this.h?this.h.next=e:this.g=e,this.h=e}},Re=()=>{const a=l.Promise.resolve(void 0);ke=()=>{a.then(Oe)}};var Oe=()=>{for(var a;a=Ee();){try{a.h.call(a.g)}catch(e){Ce(e)}var b=Ie;b.j(a),100>b.h&&(b.h++,a.next=b.g,b.g=a)}Ae=!1};function De(a,b){ve.call(this),this.h=a||1,this.g=b||l,this.j=q(this.qb,this),this.l=Date.now()}function Pe(a){a.ga=!1,a.T&&(a.g.clearTimeout(a.T),a.T=null)}function Le(a,b,e){if("function"==typeof a)e&&(a=q(a,e));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=q(a.handleEvent,a)}return 2147483647<Number(b)?-1:l.setTimeout(a,b||0)}function xe(a){a.g=Le((()=>{a.g=null,a.i&&(a.i=!1,xe(a))}),a.j);const b=a.h;a.h=null,a.m.apply(null,b)}_(De,ve),(r=De.prototype).ga=!1,r.T=null,r.qb=function(){if(this.ga){var a=Date.now()-this.l;0<a&&a<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-a):(this.T&&(this.g.clearTimeout(this.T),this.T=null),we(this,"tick"),this.ga&&(Pe(this),this.start()))}},r.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.N=function(){De.$.N.call(this),Pe(this),delete this.g};class Me extends T{constructor(a,b){super(),this.m=a,this.j=b,this.h=null,this.i=!1,this.g=null}l(a){this.h=arguments,this.g?this.i=!0:xe(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ue(a){T.call(this),this.h=a,this.g={}}_(Ue,T);var Ve=[];function Fe(a,b,e,t){Array.isArray(e)||(e&&(Ve[0]=e.toString()),e=Ve);for(var n=0;n<e.length;n++){var r=ce(b,e[n],t||a.handleEvent,!1,a.h||a);if(!r)break;a.g[r.key]=r}}function je(a){Z(a.g,(function(b,e){this.g.hasOwnProperty(e)&&de(b)}),a),a.g={}}function qe(){this.g=!0}function Be(a,b,e,t){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+function(a,b){if(!a.g)return b;if(!b)return null;try{var e=JSON.parse(b);if(e)for(a=0;a<e.length;a++)if(Array.isArray(e[a])){var t=e[a];if(!(2>t.length)){var n=t[1];if(Array.isArray(n)&&!(1>n.length)){var r=n[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<n.length;o++)n[o]=""}}}return Te(e)}catch(e){return b}}(a,e)+(t?" "+t:"")}))}Ue.prototype.N=function(){Ue.$.N.call(this),je(this)},Ue.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},qe.prototype.Ea=function(){this.g=!1},qe.prototype.info=function(){};var Ke={},ze=null;function $e(){return ze=ze||new ve}function Ge(a){C.call(this,Ke.Ta,a)}function He(a){const b=$e();we(b,new Ge(b))}function We(a,b){C.call(this,Ke.STAT_EVENT,a),this.stat=b}function Qe(a){const b=$e();we(b,new We(b,a))}function Je(a,b){C.call(this,Ke.Ua,a),this.size=b}function Xe(a,b){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){a()}),b)}Ke.Ta="serverreachability",_(Ge,C),Ke.STAT_EVENT="statevent",_(We,C),Ke.Ua="timingevent",_(Je,C);var Ye={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Ze={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function et(){}function tt(a){return a.h||(a.h=a.i())}function nt(){}et.prototype.h=null;var it,st={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ot(){C.call(this,"d")}function at(){C.call(this,"c")}function ct(){}function ut(a,b,e,t){this.l=a,this.j=b,this.m=e,this.W=t||1,this.U=new Ue(this),this.P=lt,a=U?125:void 0,this.V=new De(a),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ht}function ht(){this.i=null,this.g="",this.h=!1}_(ot,C),_(at,C),_(ct,et),ct.prototype.g=function(){return new XMLHttpRequest},ct.prototype.i=function(){return{}},it=new ct;var lt=45e3,ft={},pt={};function gt(a,b,e){a.L=1,a.A=Lt(Nt(b)),a.u=e,a.S=!0,mt(a,null)}function mt(a,b){a.G=Date.now(),_t(a),a.B=Nt(a.A);var e=a.B,t=a.W;Array.isArray(t)||(t=[String(t)]),Ht(e.i,"t",t),a.o=0,e=a.l.J,a.h=new ht,a.g=Gn(a.l,e?b:null,!a.u),0<a.O&&(a.M=new Me(q(a.Pa,a,a.g),a.O)),Fe(a.U,a.g,"readystatechange",a.nb),b=a.I?ee(a.I):{},a.u?(a.v||(a.v="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.ha(a.B,a.v,a.u,b)):(a.v="GET",a.g.ha(a.B,a.v,null,b)),He(),function(a,b,e,t,n,r){a.info((function(){if(a.g)if(r)for(var o="",c=r.split("&"),h=0;h<c.length;h++){var l=c[h].split("=");if(1<l.length){var u=l[0];l=l[1];var d=u.split("_");o=2<=d.length&&"type"==d[1]?o+(u+"=")+l+"&":o+(u+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+t+") [attempt "+n+"]: "+b+"\n"+e+"\n"+o}))}(a.j,a.v,a.B,a.m,a.W,a.u)}function yt(a){return!!a.g&&("GET"==a.v&&2!=a.L&&a.l.Ha)}function vt(a,b,e){let t,n=!0;for(;!a.J&&a.o<e.length;){if(t=wt(a,e),t==pt){4==b&&(a.s=4,Qe(14),n=!1),Be(a.j,a.m,null,"[Incomplete Response]");break}if(t==ft){a.s=4,Qe(15),Be(a.j,a.m,e,"[Invalid Chunk]"),n=!1;break}Be(a.j,a.m,t,null),St(a,t)}yt(a)&&0!=a.o&&(a.h.g=a.h.g.slice(a.o),a.o=0),4!=b||0!=e.length||a.h.h||(a.s=1,Qe(16),n=!1),a.i=a.i&&n,n?0<e.length&&!a.ba&&(a.ba=!0,(b=a.l).g==a&&b.ca&&!b.M&&(b.l.info("Great, no buffering proxy detected. Bytes received: "+e.length),Vn(b),b.M=!0,Qe(11))):(Be(a.j,a.m,e,"[Invalid Chunked Response]"),bt(a),It(a))}function wt(a,b){var e=a.o,t=b.indexOf("\n",e);return-1==t?pt:(e=Number(b.substring(e,t)),isNaN(e)?ft:(t+=1)+e>b.length?pt:(b=b.slice(t,t+e),a.o=t+e,b))}function _t(a){a.Y=Date.now()+a.P,Tt(a,a.P)}function Tt(a,b){if(null!=a.C)throw Error("WatchDog timer not null");a.C=Xe(q(a.lb,a),b)}function Et(a){a.C&&(l.clearTimeout(a.C),a.C=null)}function It(a){0==a.l.H||a.J||qn(a.l,a)}function bt(a){Et(a);var b=a.M;b&&"function"==typeof b.sa&&b.sa(),a.M=null,Pe(a.V),je(a.U),a.g&&(b=a.g,a.g=null,b.abort(),b.sa())}function St(a,b){try{var e=a.l;if(0!=e.H&&(e.g==a||Zt(e.i,a)))if(!a.K&&Zt(e.i,a)&&3==e.H){try{var t=e.Ja.g.parse(b)}catch(e){t=null}if(Array.isArray(t)&&3==t.length){var n=t;if(0==n[0]){e:if(!e.u){if(e.g){if(!(e.g.G+3e3<a.G))break e;jn(e),Rn(e)}Un(e),Qe(18)}}else e.Fa=n[1],0<e.Fa-e.V&&37500>n[2]&&e.G&&0==e.A&&!e.v&&(e.v=Xe(q(e.ib,e),6e3));if(1>=Yt(e.i)&&e.oa){try{e.oa()}catch(e){}e.oa=void 0}}else Kn(e,11)}else if((a.K||e.g==a)&&jn(e),!A(b))for(n=e.Ja.g.parse(b),b=0;b<n.length;b++){let l=n[b];if(e.V=l[0],l=l[1],2==e.H)if("c"==l[0]){e.K=l[1],e.pa=l[2];const u=l[3];null!=u&&(e.ra=u,e.l.info("VER="+e.ra));const n=l[4];null!=n&&(e.Ga=n,e.l.info("SVER="+e.Ga));const d=l[5];null!=d&&"number"==typeof d&&0<d&&(t=1.5*d,e.L=t,e.l.info("backChannelRequestTimeoutMs_="+t)),t=e;const f=a.g;if(f){const e=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var r=t.i;r.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(en(r,r.h),r.h=null))}if(t.F){const e=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(t.Da=e,Pt(t.I,t.F,e))}}e.H=3,e.h&&e.h.Ba(),e.ca&&(e.S=Date.now()-a.G,e.l.info("Handshake RTT: "+e.S+"ms"));var o=a;if((t=e).wa=$n(t,t.J?t.pa:null,t.Y),o.K){tn(t.i,o);var c=o,h=t.L;h&&c.setTimeout(h),c.C&&(Et(c),_t(c)),t.g=o}else Mn(t);0<e.j.length&&Dn(e)}else"stop"!=l[0]&&"close"!=l[0]||Kn(e,7);else 3==e.H&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?Kn(e,7):Nn(e):"noop"!=l[0]&&e.h&&e.h.Aa(l),e.A=0)}He()}catch(e){}}function Ct(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(d(a)||"string"==typeof a)Array.prototype.forEach.call(a,b,void 0);else for(var e=function(a){if(a.ta&&"function"==typeof a.ta)return a.ta();if(!a.Z||"function"!=typeof a.Z){if("undefined"!=typeof Map&&a instanceof Map)return Array.from(a.keys());if(!("undefined"!=typeof Set&&a instanceof Set)){if(d(a)||"string"==typeof a){var b=[];a=a.length;for(var e=0;e<a;e++)b.push(e);return b}b=[],e=0;for(const t in a)b[e++]=t;return b}}}(a),t=function(a){if(a.Z&&"function"==typeof a.Z)return a.Z();if("undefined"!=typeof Map&&a instanceof Map||"undefined"!=typeof Set&&a instanceof Set)return Array.from(a.values());if("string"==typeof a)return a.split("");if(d(a)){for(var b=[],e=a.length,t=0;t<e;t++)b.push(a[t]);return b}for(t in b=[],e=0,a)b[e++]=a[t];return b}(a),n=t.length,r=0;r<n;r++)b.call(void 0,t[r],e&&e[r],a)}(r=ut.prototype).setTimeout=function(a){this.P=a},r.nb=function(a){a=a.target;const b=this.M;b&&3==In(a)?b.l():this.Pa(a)},r.Pa=function(a){try{if(a==this.g)e:{const u=In(this.g);var b=this.g.Ia();this.g.da();if(!(3>u)&&(3!=u||U||this.g&&(this.h.h||this.g.ja()||bn(this.g)))){this.J||4!=u||7==b||He(),Et(this);var e=this.g.da();this.ca=e;t:if(yt(this)){var t=bn(this.g);a="";var n=t.length,r=4==In(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){bt(this),It(this);var o="";break t}this.h.i=new l.TextDecoder}for(b=0;b<n;b++)this.h.h=!0,a+=this.h.i.decode(t[b],{stream:r&&b==n-1});t.length=0,this.h.g+=a,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==e,function(a,b,e,t,n,r,o){a.info((function(){return"XMLHTTP RESP ("+t+") [ attempt "+n+"]: "+b+"\n"+e+"\n"+r+" "+o}))}(this.j,this.v,this.B,this.m,this.W,u,e),this.i){if(this.aa&&!this.K){t:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!A(c)){var d=c;break t}}d=null}if(!(e=d)){this.i=!1,this.s=3,Qe(12),bt(this),It(this);break e}Be(this.j,this.m,e,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,St(this,e)}this.S?(vt(this,u,o),U&&this.i&&3==u&&(Fe(this.U,this.V,"tick",this.mb),this.V.start())):(Be(this.j,this.m,o,null),St(this,o)),4==u&&bt(this),this.i&&!this.J&&(4==u?qn(this.l,this):(this.i=!1,_t(this)))}else(function(a){const b={};a=(a.g&&2<=In(a)&&a.g.getAllResponseHeaders()||"").split("\r\n");for(let t=0;t<a.length;t++){if(A(a[t]))continue;var e=Se(a[t]);const n=e[0];if("string"!=typeof(e=e[1]))continue;e=e.trim();const r=b[n]||[];b[n]=r,r.push(e)}!function(a,b){for(const e in a)b.call(void 0,a[e],e,a)}(b,(function(e){return e.join(", ")}))})(this.g),400==e&&0<o.indexOf("Unknown SID")?(this.s=3,Qe(12)):(this.s=0,Qe(13)),bt(this),It(this)}}}catch(e){}},r.mb=function(){if(this.g){var a=In(this.g),b=this.g.ja();this.o<b.length&&(Et(this),vt(this,a,b),this.i&&4!=a&&_t(this))}},r.cancel=function(){this.J=!0,bt(this)},r.lb=function(){this.C=null;const a=Date.now();0<=a-this.Y?(function(a,b){a.info((function(){return"TIMEOUT: "+b}))}(this.j,this.B),2!=this.L&&(He(),Qe(17)),bt(this),this.s=2,It(this)):Tt(this,this.Y-a)};var kt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function At(a){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,a instanceof At){this.h=a.h,Rt(this,a.j),this.s=a.s,this.g=a.g,Ot(this,a.m),this.l=a.l;var b=a.i,e=new Kt;e.i=b.i,b.g&&(e.g=new Map(b.g),e.h=b.h),Dt(this,e),this.o=a.o}else a&&(b=String(a).match(kt))?(this.h=!1,Rt(this,b[1]||"",!0),this.s=xt(b[2]||""),this.g=xt(b[3]||"",!0),Ot(this,b[4]),this.l=xt(b[5]||"",!0),Dt(this,b[6]||"",!0),this.o=xt(b[7]||"")):(this.h=!1,this.i=new Kt(null,this.h))}function Nt(a){return new At(a)}function Rt(a,b,e){a.j=e?xt(b,!0):b,a.j&&(a.j=a.j.replace(/:$/,""))}function Ot(a,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);a.m=b}else a.m=null}function Dt(a,b,e){b instanceof Kt?(a.i=b,function(a,b){b&&!a.j&&(zt(a),a.i=null,a.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&($t(this,t),Ht(this,n,e))}),a)),a.j=b}(a.i,a.h)):(e||(b=Mt(b,qt)),a.i=new Kt(b,a.h))}function Pt(a,b,e){a.i.set(b,e)}function Lt(a){return Pt(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function xt(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Mt(a,b,e){return"string"==typeof a?(a=encodeURI(a).replace(b,Ut),e&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Ut(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}At.prototype.toString=function(){var a=[],b=this.j;b&&a.push(Mt(b,Vt,!0),":");var e=this.g;return(e||"file"==b)&&(a.push("//"),(b=this.s)&&a.push(Mt(b,Vt,!0),"@"),a.push(encodeURIComponent(String(e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(e=this.m)&&a.push(":",String(e))),(e=this.l)&&(this.g&&"/"!=e.charAt(0)&&a.push("/"),a.push(Mt(e,"/"==e.charAt(0)?jt:Ft,!0))),(e=this.i.toString())&&a.push("?",e),(e=this.o)&&a.push("#",Mt(e,Bt)),a.join("")};var Vt=/[#\/\?@]/g,Ft=/[#\?:]/g,jt=/[#\?]/g,qt=/[#\?@]/g,Bt=/#/g;function Kt(a,b){this.h=this.g=null,this.i=a||null,this.j=!!b}function zt(a){a.g||(a.g=new Map,a.h=0,a.i&&function(a,b){if(a){a=a.split("&");for(var e=0;e<a.length;e++){var t=a[e].indexOf("="),n=null;if(0<=t){var r=a[e].substring(0,t);n=a[e].substring(t+1)}else r=a[e];b(r,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(a.i,(function(b,e){a.add(decodeURIComponent(b.replace(/\+/g," ")),e)})))}function $t(a,b){zt(a),b=Wt(a,b),a.g.has(b)&&(a.i=null,a.h-=a.g.get(b).length,a.g.delete(b))}function Gt(a,b){return zt(a),b=Wt(a,b),a.g.has(b)}function Ht(a,b,e){$t(a,b),0<e.length&&(a.i=null,a.g.set(Wt(a,b),I(e)),a.h+=e.length)}function Wt(a,b){return b=String(b),a.j&&(b=b.toLowerCase()),b}(r=Kt.prototype).add=function(a,b){zt(this),this.i=null,a=Wt(this,a);var e=this.g.get(a);return e||this.g.set(a,e=[]),e.push(b),this.h+=1,this},r.forEach=function(a,b){zt(this),this.g.forEach((function(e,t){e.forEach((function(e){a.call(b,e,t,this)}),this)}),this)},r.ta=function(){zt(this);const a=Array.from(this.g.values()),b=Array.from(this.g.keys()),e=[];for(let t=0;t<b.length;t++){const n=a[t];for(let r=0;r<n.length;r++)e.push(b[t])}return e},r.Z=function(a){zt(this);let b=[];if("string"==typeof a)Gt(this,a)&&(b=b.concat(this.g.get(Wt(this,a))));else{a=Array.from(this.g.values());for(let e=0;e<a.length;e++)b=b.concat(a[e])}return b},r.set=function(a,b){return zt(this),this.i=null,Gt(this,a=Wt(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[b]),this.h+=1,this},r.get=function(a,b){return a&&0<(a=this.Z(a)).length?String(a[0]):b},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],b=Array.from(this.g.keys());for(var e=0;e<b.length;e++){var t=b[e];const r=encodeURIComponent(String(t)),o=this.Z(t);for(t=0;t<o.length;t++){var n=r;""!==o[t]&&(n+="="+encodeURIComponent(String(o[t]))),a.push(n)}}return this.i=a.join("&")};var Qt=class{constructor(a,b){this.g=a,this.map=b}};function Jt(a){this.l=a||dd,l.PerformanceNavigationTiming?a=0<(a=l.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(l.g&&l.g.Ka&&l.g.Ka()&&l.g.Ka().dc),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var dd=10;function Xt(a){return!!a.h||!!a.g&&a.g.size>=a.j}function Yt(a){return a.h?1:a.g?a.g.size:0}function Zt(a,b){return a.h?a.h==b:!!a.g&&a.g.has(b)}function en(a,b){a.g?a.g.add(b):a.h=b}function tn(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}function nn(a){if(null!=a.h)return a.i.concat(a.h.F);if(null!=a.g&&0!==a.g.size){let b=a.i;for(const e of a.g.values())b=b.concat(e.F);return b}return I(a.i)}Jt.prototype.cancel=function(){if(this.i=nn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}};var rn=class{stringify(a){return l.JSON.stringify(a,void 0)}parse(a){return l.JSON.parse(a,void 0)}};function sn(){this.g=new rn}function on(a,b,e){const t=e||"";try{Ct(a,(function(e,n){let r=e;p(e)&&(r=Te(e)),b.push(t+n+"="+encodeURIComponent(r))}))}catch(e){throw b.push(t+"type="+encodeURIComponent("_badmap")),e}}function an(a,b,e,t,n){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,n(t)}catch(e){}}function cn(a){this.l=a.ec||null,this.j=a.ob||!1}function un(a,b){ve.call(this),this.F=a,this.u=b,this.m=void 0,this.readyState=hn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}_(cn,et),cn.prototype.g=function(){return new un(this.l,this.j)},cn.prototype.i=function(a){return function(){return a}}({}),_(un,ve);var hn=0;function ln(a){a.j.read().then(a.Xa.bind(a)).catch(a.ka.bind(a))}function dn(a){a.readyState=4,a.l=null,a.j=null,a.A=null,fn(a)}function fn(a){a.onreadystatechange&&a.onreadystatechange.call(a)}(r=un.prototype).open=function(a,b){if(this.readyState!=hn)throw this.abort(),Error("Error reopening a connection");this.C=a,this.B=b,this.readyState=1,fn(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.v,method:this.C,credentials:this.m,cache:void 0};a&&(b.body=a),(this.F||l).fetch(new Request(this.B,b)).then(this.$a.bind(this),this.ka.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,dn(this)),this.readyState=hn},r.$a=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,fn(this)),this.g&&(this.readyState=3,fn(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==l.ReadableStream&&"body"in a){if(this.j=a.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ln(this)}else a.text().then(this.Za.bind(this),this.ka.bind(this))},r.Xa=function(a){if(this.g){if(this.u&&a.value)this.response.push(a.value);else if(!this.u){var b=a.value?a.value:new Uint8Array(0);(b=this.A.decode(b,{stream:!a.done}))&&(this.response=this.responseText+=b)}a.done?dn(this):fn(this),3==this.readyState&&ln(this)}},r.Za=function(a){this.g&&(this.response=this.responseText=a,dn(this))},r.Ya=function(a){this.g&&(this.response=a,dn(this))},r.ka=function(){this.g&&dn(this)},r.setRequestHeader=function(a,b){this.v.append(a,b)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],b=this.h.entries();for(var e=b.next();!e.done;)e=e.value,a.push(e[0]+": "+e[1]),e=b.next();return a.join("\r\n")},Object.defineProperty(un.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}});var pn=l.JSON.parse;function gn(a){ve.call(this),this.headers=new Map,this.u=a||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=mn,this.L=this.M=!1}_(gn,ve);var mn="",td=/^https?$/i,yn=["POST","PUT"];function vn(a,b){a.h=!1,a.g&&(a.l=!0,a.g.abort(),a.l=!1),a.j=b,a.m=5,wn(a),Tn(a)}function wn(a){a.F||(a.F=!0,we(a,"complete"),we(a,"error"))}function _n(a){if(a.h&&void 0!==h&&(!a.C[1]||4!=In(a)||2!=a.da()))if(a.v&&4==In(a))Le(a.La,0,a);else if(we(a,"readystatechange"),4==In(a)){a.h=!1;try{const o=a.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break e;default:b=!1}var e;if(!(e=b)){var t;if(t=0===o){var n=String(a.I).match(kt)[1]||null;!n&&l.self&&l.self.location&&(n=l.self.location.protocol.slice(0,-1)),t=!td.test(n?n.toLowerCase():"")}e=t}if(e)we(a,"complete"),we(a,"success");else{a.m=6;try{var r=2<In(a)?a.g.statusText:""}catch(e){r=""}a.j=r+" ["+a.da()+"]",wn(a)}}finally{Tn(a)}}}function Tn(a,b){if(a.g){En(a);const e=a.g,t=a.C[0]?()=>{}:null;a.g=null,a.C=null,b||we(a,"ready");try{e.onreadystatechange=t}catch(e){}}}function En(a){a.g&&a.L&&(a.g.ontimeout=null),a.A&&(l.clearTimeout(a.A),a.A=null)}function In(a){return a.g?a.g.readyState:0}function bn(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.K){case mn:case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Sn(a){let b="";return Z(a,(function(e,t){b+=t,b+=":",b+=e,b+="\r\n"})),b}function Cn(a,b,e){e:{for(t in e){var t=!1;break e}t=!0}t||(e=Sn(e),"string"==typeof a?null!=e&&encodeURIComponent(String(e)):Pt(a,b,e))}function kn(a,b,e){return e&&e.internalChannelParams&&e.internalChannelParams[a]||b}function An(a){this.Ga=0,this.j=[],this.l=new qe,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=kn("failFast",!1,a),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=kn("baseRetryDelayMs",5e3,a),this.hb=kn("retryDelaySeedMs",1e4,a),this.eb=kn("forwardChannelMaxRetries",2,a),this.xa=kn("forwardChannelRequestTimeoutMs",2e4,a),this.va=a&&a.xmlHttpFactory||void 0,this.Ha=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.i=new Jt(a&&a.concurrentRequestLimit),this.Ja=new sn,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=a&&a.bc||!1,a&&a.Ea&&this.l.Ea(),a&&a.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&a&&a.detectBufferingProxy||!1,this.qa=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.qa=a.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Nn(a){if(On(a),3==a.H){var b=a.W++,e=Nt(a.I);if(Pt(e,"SID",a.K),Pt(e,"RID",b),Pt(e,"TYPE","terminate"),Ln(a,e),(b=new ut(a,a.l,b)).L=2,b.A=Lt(Nt(e)),e=!1,l.navigator&&l.navigator.sendBeacon)try{e=l.navigator.sendBeacon(b.A.toString(),"")}catch(e){}!e&&l.Image&&((new Image).src=b.A,e=!0),e||(b.g=Gn(b.l,null),b.g.ha(b.A)),b.G=Date.now(),_t(b)}zn(a)}function Rn(a){a.g&&(Vn(a),a.g.cancel(),a.g=null)}function On(a){Rn(a),a.u&&(l.clearTimeout(a.u),a.u=null),jn(a),a.i.cancel(),a.m&&("number"==typeof a.m&&l.clearTimeout(a.m),a.m=null)}function Dn(a){if(!Xt(a.i)&&!a.m){a.m=!0;var b=a.Na;ke||Re(),Ae||(ke(),Ae=!0),Ne.add(b,a),a.C=0}}function Pn(a,b){var e;e=b?b.m:a.W++;const t=Nt(a.I);Pt(t,"SID",a.K),Pt(t,"RID",e),Pt(t,"AID",a.V),Ln(a,t),a.o&&a.s&&Cn(t,a.o,a.s),e=new ut(a,a.l,e,a.C+1),null===a.o&&(e.I=a.s),b&&(a.j=b.F.concat(a.j)),b=xn(a,e,1e3),e.setTimeout(Math.round(.5*a.xa)+Math.round(.5*a.xa*Math.random())),en(a.i,e),gt(e,t,b)}function Ln(a,b){a.na&&Z(a.na,(function(e,t){Pt(b,t,e)})),a.h&&Ct({},(function(e,t){Pt(b,t,e)}))}function xn(a,b,e){e=Math.min(a.j.length,e);var t=a.h?q(a.h.Va,a.h,a):null;e:{var n=a.j;let r=-1;for(;;){const o=["count="+e];-1==r?0<e?(r=n[0].g,o.push("ofs="+r)):r=0:o.push("ofs="+r);let c=!0;for(let h=0;h<e;h++){let e=n[h].g;const u=n[h].map;if(e-=r,0>e)r=Math.max(0,n[h].g-100),c=!1;else try{on(u,o,"req"+e+"_")}catch(e){t&&t(u)}}if(c){t=o.join("&");break e}}}return a=a.j.splice(0,e),b.F=a,t}function Mn(a){if(!a.g&&!a.u){a.ba=1;var b=a.Ma;ke||Re(),Ae||(ke(),Ae=!0),Ne.add(b,a),a.A=0}}function Un(a){return!(a.g||a.u||3<=a.A)&&(a.ba++,a.u=Xe(q(a.Ma,a),Bn(a,a.A)),a.A++,!0)}function Vn(a){null!=a.B&&(l.clearTimeout(a.B),a.B=null)}function Fn(a){a.g=new ut(a,a.l,"rpc",a.ba),null===a.o&&(a.g.I=a.s),a.g.O=0;var b=Nt(a.wa);Pt(b,"RID","rpc"),Pt(b,"SID",a.K),Pt(b,"AID",a.V),Pt(b,"CI",a.G?"0":"1"),!a.G&&a.qa&&Pt(b,"TO",a.qa),Pt(b,"TYPE","xmlhttp"),Ln(a,b),a.o&&a.s&&Cn(b,a.o,a.s),a.L&&a.g.setTimeout(a.L);var e=a.g;a=a.pa,e.L=1,e.A=Lt(Nt(b)),e.u=null,e.S=!0,mt(e,a)}function jn(a){null!=a.v&&(l.clearTimeout(a.v),a.v=null)}function qn(a,b){var e=null;if(a.g==b){jn(a),Vn(a),a.g=null;var t=2}else{if(!Zt(a.i,b))return;e=b.F,tn(a.i,b),t=1}if(0!=a.H)if(b.i)if(1==t){e=b.u?b.u.length:0,b=Date.now()-b.G;var n=a.C;we(t=$e(),new Je(t,e)),Dn(a)}else Mn(a);else if(3==(n=b.s)||0==n&&0<b.ca||!(1==t&&function(a,b){return!(Yt(a.i)>=a.i.j-(a.m?1:0)||(a.m?(a.j=b.F.concat(a.j),0):1==a.H||2==a.H||a.C>=(a.cb?0:a.eb)||(a.m=Xe(q(a.Na,a,b),Bn(a,a.C)),a.C++,0)))}(a,b)||2==t&&Un(a)))switch(e&&0<e.length&&(b=a.i,b.i=b.i.concat(e)),n){case 1:Kn(a,5);break;case 4:Kn(a,10);break;case 3:Kn(a,6);break;default:Kn(a,2)}}function Bn(a,b){let e=a.ab+Math.floor(Math.random()*a.hb);return a.isActive()||(e*=2),e*b}function Kn(a,b){if(a.l.info("Error code "+b),2==b){var e=null;a.h&&(e=null);var t=q(a.pb,a);e||(e=new At("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||Rt(e,"https"),Lt(e)),function(a,b){const e=new qe;if(l.Image){const t=new Image;t.onload=w(an,e,t,"TestLoadImage: loaded",!0,b),t.onerror=w(an,e,t,"TestLoadImage: error",!1,b),t.onabort=w(an,e,t,"TestLoadImage: abort",!1,b),t.ontimeout=w(an,e,t,"TestLoadImage: timeout",!1,b),l.setTimeout((function(){t.ontimeout&&t.ontimeout()}),1e4),t.src=a}else b(!1)}(e.toString(),t)}else Qe(2);a.H=0,a.h&&a.h.za(b),zn(a),On(a)}function zn(a){if(a.H=0,a.ma=[],a.h){const b=nn(a.i);0==b.length&&0==a.j.length||(S(a.ma,b),S(a.ma,a.j),a.i.i.length=0,I(a.j),a.j.length=0),a.h.ya()}}function $n(a,b,e){var t=e instanceof At?Nt(e):new At(e);if(""!=t.g)b&&(t.g=b+"."+t.g),Ot(t,t.m);else{var n=l.location;t=n.protocol,b=b?b+"."+n.hostname:n.hostname,n=+n.port;var r=new At(null);t&&Rt(r,t),b&&(r.g=b),n&&Ot(r,n),e&&(r.l=e),t=r}return e=a.F,b=a.Da,e&&b&&Pt(t,e,b),Pt(t,"VER",a.ra),Ln(a,t),t}function Gn(a,b,e){if(b&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return(b=a.Ha&&!a.va?new gn(new cn({ob:e})):new gn(a.va)).Oa(a.J),b}function Hn(){}function Wn(){if(x&&!(10<=Number(G)))throw Error("Environmental error: no available transport.")}function Qn(a,b){ve.call(this),this.g=new An(b),this.l=a,this.h=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.s=a,a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.Ca&&(a?a["X-WebChannel-Client-Profile"]=b.Ca:a={"X-WebChannel-Client-Profile":b.Ca}),this.g.U=a,(a=b&&b.cc)&&!A(a)&&(this.g.o=a),this.A=b&&b.supportsCrossDomainXhr||!1,this.v=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!A(b)&&(this.g.F=b,null!==(a=this.h)&&b in a&&(b in(a=this.h)&&delete a[b])),this.j=new Yn(this)}function Jn(a){ot.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var b=a.__sm__;if(b){e:{for(const e in b){a=e;break e}a=void 0}(this.i=a)&&(a=this.i,b=null!==b&&a in b?b[a]:void 0),this.data=b}else this.data=a}function Xn(){at.call(this),this.status=1}function Yn(a){this.g=a}function Zn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function er(a,b,e){e||(e=0);var t=Array(16);if("string"==typeof b)for(var n=0;16>n;++n)t[n]=b.charCodeAt(e++)|b.charCodeAt(e++)<<8|b.charCodeAt(e++)<<16|b.charCodeAt(e++)<<24;else for(n=0;16>n;++n)t[n]=b[e++]|b[e++]<<8|b[e++]<<16|b[e++]<<24;b=a.g[0],e=a.g[1],n=a.g[2];var r=a.g[3],o=b+(r^e&(n^r))+t[0]+3614090360&4294967295;o=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=(e=(n=(r=(b=e+(o<<7&4294967295|o>>>25))+((o=r+(n^b&(e^n))+t[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=n+(e^r&(b^e))+t[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=e+(b^n&(r^b))+t[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=b+(r^e&(n^r))+t[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=r+(n^b&(e^n))+t[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=n+(e^r&(b^e))+t[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=e+(b^n&(r^b))+t[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=b+(r^e&(n^r))+t[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=r+(n^b&(e^n))+t[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=n+(e^r&(b^e))+t[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=e+(b^n&(r^b))+t[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=b+(r^e&(n^r))+t[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=r+(n^b&(e^n))+t[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=n+(e^r&(b^e))+t[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=e+(b^n&(r^b))+t[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=b+(n^r&(e^n))+t[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=r+(e^n&(b^e))+t[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^e&(r^b))+t[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=e+(r^b&(n^r))+t[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=b+(n^r&(e^n))+t[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=r+(e^n&(b^e))+t[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^e&(r^b))+t[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=e+(r^b&(n^r))+t[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=b+(n^r&(e^n))+t[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=r+(e^n&(b^e))+t[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^e&(r^b))+t[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=e+(r^b&(n^r))+t[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=b+(n^r&(e^n))+t[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=r+(e^n&(b^e))+t[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^e&(r^b))+t[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=e+(r^b&(n^r))+t[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=b+(e^n^r)+t[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^e^n)+t[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^e)+t[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=e+(n^r^b)+t[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=b+(e^n^r)+t[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^e^n)+t[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^e)+t[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=e+(n^r^b)+t[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=b+(e^n^r)+t[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^e^n)+t[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^e)+t[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=e+(n^r^b)+t[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=b+(e^n^r)+t[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^e^n)+t[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^e)+t[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=e+(n^r^b)+t[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=b+(n^(e|~r))+t[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=r+(e^(b|~n))+t[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=n+(b^(r|~e))+t[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=e+(r^(n|~b))+t[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=b+(n^(e|~r))+t[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=r+(e^(b|~n))+t[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=n+(b^(r|~e))+t[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=e+(r^(n|~b))+t[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=b+(n^(e|~r))+t[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=r+(e^(b|~n))+t[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=n+(b^(r|~e))+t[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=e+(r^(n|~b))+t[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((r=(b=e+((o=b+(n^(e|~r))+t[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=r+(e^(b|~n))+t[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((n=r+((o=n+(b^(r|~e))+t[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~b))+t[9]+3951481745&4294967295,a.g[0]=a.g[0]+b&4294967295,a.g[1]=a.g[1]+(n+(o<<21&4294967295|o>>>11))&4294967295,a.g[2]=a.g[2]+n&4294967295,a.g[3]=a.g[3]+r&4294967295}function nr(a,b){this.h=b;for(var e=[],t=!0,n=a.length-1;0<=n;n--){var r=0|a[n];t&&r==b||(e[n]=r,t=!1)}this.g=e}(r=gn.prototype).Oa=function(a){this.M=a},r.ha=function(a,b,e,t){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+a);b=b?b.toUpperCase():"GET",this.I=a,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():it.g(),this.C=this.u?tt(this.u):tt(it),this.g.onreadystatechange=q(this.La,this);try{this.G=!0,this.g.open(b,String(a),!0),this.G=!1}catch(e){return void vn(this,e)}if(a=e||"",e=new Map(this.headers),t)if(Object.getPrototypeOf(t)===Object.prototype)for(var n in t)e.set(n,t[n]);else{if("function"!=typeof t.keys||"function"!=typeof t.get)throw Error("Unknown input type for opt_headers: "+String(t));for(const n of t.keys())e.set(n,t.get(n))}t=Array.from(e.keys()).find((e=>"content-type"==e.toLowerCase())),n=l.FormData&&a instanceof l.FormData,!(0<=E(yn,b))||t||n||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,n]of e)this.g.setRequestHeader(t,n);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{En(this),0<this.B&&((this.L=function(a){return x&&"number"==typeof a.timeout&&void 0!==a.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q(this.ua,this)):this.A=Le(this.ua,this.B,this)),this.v=!0,this.g.send(a),this.v=!1}catch(e){vn(this,e)}},r.ua=function(){void 0!==h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,we(this,"timeout"),this.abort(8))},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=a||7,we(this,"complete"),we(this,"abort"),Tn(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Tn(this,!0)),gn.$.N.call(this)},r.La=function(){this.s||(this.G||this.v||this.l?_n(this):this.kb())},r.kb=function(){_n(this)},r.isActive=function(){return!!this.g},r.da=function(){try{return 2<In(this)?this.g.status:-1}catch(e){return-1}},r.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},r.Wa=function(a){if(this.g){var b=this.g.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),pn(b)}},r.Ia=function(){return this.m},r.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=An.prototype).ra=8,r.H=1,r.Na=function(a){if(this.m)if(this.m=null,1==this.H){if(!a){this.W=Math.floor(1e5*Math.random()),a=this.W++;const n=new ut(this,this.l,a);let r=this.s;if(this.U&&(r?(r=ee(r),ne(r,this.U)):r=this.U),null!==this.o||this.O||(n.I=r,r=null),this.P)e:{for(var b=0,e=0;e<this.j.length;e++){var t=this.j[e];if(void 0===(t="__data__"in t.map&&"string"==typeof(t=t.map.__data__)?t.length:void 0))break;if(4096<(b+=t)){b=e;break e}if(4096===b||e===this.j.length-1){b=e+1;break e}}b=1e3}else b=1e3;b=xn(this,n,b),Pt(e=Nt(this.I),"RID",a),Pt(e,"CVER",22),this.F&&Pt(e,"X-HTTP-Session-Id",this.F),Ln(this,e),r&&(this.O?b="headers="+encodeURIComponent(String(Sn(r)))+"&"+b:this.o&&Cn(e,this.o,r)),en(this.i,n),this.bb&&Pt(e,"TYPE","init"),this.P?(Pt(e,"$req",b),Pt(e,"SID","null"),n.aa=!0,gt(n,e,null)):gt(n,e,b),this.H=2}}else 3==this.H&&(a?Pn(this,a):0==this.j.length||Xt(this.i)||Pn(this))},r.Ma=function(){if(this.u=null,Fn(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var a=2*this.S;this.l.info("BP detection timer enabled: "+a),this.B=Xe(q(this.jb,this),a)}},r.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Qe(10),Rn(this),Fn(this))},r.ib=function(){null!=this.v&&(this.v=null,Rn(this),Un(this),Qe(19))},r.pb=function(a){a?(this.l.info("Successfully pinged google.com"),Qe(2)):(this.l.info("Failed to ping google.com"),Qe(1))},r.isActive=function(){return!!this.h&&this.h.isActive(this)},(r=Hn.prototype).Ba=function(){},r.Aa=function(){},r.za=function(){},r.ya=function(){},r.isActive=function(){return!0},r.Va=function(){},Wn.prototype.g=function(a,b){return new Qn(a,b)},_(Qn,ve),Qn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var a=this.g,b=this.l,e=this.h||void 0;Qe(0),a.Y=b,a.na=e||{},a.G=a.aa,a.I=$n(a,null,a.Y),Dn(a)},Qn.prototype.close=function(){Nn(this.g)},Qn.prototype.u=function(a){var b=this.g;if("string"==typeof a){var e={};e.__data__=a,a=e}else this.v&&((e={}).__data__=Te(a),a=e);b.j.push(new Qt(b.fb++,a)),3==b.H&&Dn(b)},Qn.prototype.N=function(){this.g.h=null,delete this.j,Nn(this.g),delete this.g,Qn.$.N.call(this)},_(Jn,ot),_(Xn,at),_(Yn,Hn),Yn.prototype.Ba=function(){we(this.g,"a")},Yn.prototype.Aa=function(a){we(this.g,new Jn(a))},Yn.prototype.za=function(a){we(this.g,new Xn)},Yn.prototype.ya=function(){we(this.g,"b")},_(Zn,(function(){this.blockSize=-1})),Zn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Zn.prototype.j=function(a,b){void 0===b&&(b=a.length);for(var e=b-this.blockSize,t=this.m,n=this.h,r=0;r<b;){if(0==n)for(;r<=e;)er(this,a,r),r+=this.blockSize;if("string"==typeof a){for(;r<b;)if(t[n++]=a.charCodeAt(r++),n==this.blockSize){er(this,t),n=0;break}}else for(;r<b;)if(t[n++]=a[r++],n==this.blockSize){er(this,t),n=0;break}}this.h=n,this.i+=b},Zn.prototype.l=function(){var a=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);a[0]=128;for(var b=1;b<a.length-8;++b)a[b]=0;var e=8*this.i;for(b=a.length-8;b<a.length;++b)a[b]=255&e,e/=256;for(this.j(a),a=Array(16),b=e=0;4>b;++b)for(var t=0;32>t;t+=8)a[e++]=this.g[b]>>>t&255;return a};var rr={};function ir(a){return-128<=a&&128>a?function(a,b){var e=rr;return Object.prototype.hasOwnProperty.call(e,a)?e[a]:e[a]=b(a)}(a,(function(b){return new nr([0|b],0>b?-1:0)})):new nr([0|a],0>a?-1:0)}function sr(a){if(isNaN(a)||!isFinite(a))return ar;if(0>a)return fr(sr(-a));for(var b=[],e=1,t=0;a>=e;t++)b[t]=a/e|0,e*=or;return new nr(b,0)}var or=4294967296,ar=ir(0),cr=ir(1),ur=ir(16777216);function lr(a){if(0!=a.h)return!1;for(var b=0;b<a.g.length;b++)if(0!=a.g[b])return!1;return!0}function dr(a){return-1==a.h}function fr(a){for(var b=a.g.length,e=[],t=0;t<b;t++)e[t]=~a.g[t];return new nr(e,~a.h).add(cr)}function pr(a,b){return a.add(fr(b))}function gr(a,b){for(;(65535&a[b])!=a[b];)a[b+1]+=a[b]>>>16,a[b]&=65535,b++}function mr(a,b){this.g=a,this.h=b}function yr(a,b){if(lr(b))throw Error("division by zero");if(lr(a))return new mr(ar,ar);if(dr(a))return b=yr(fr(a),b),new mr(fr(b.g),fr(b.h));if(dr(b))return b=yr(a,fr(b)),new mr(fr(b.g),b.h);if(30<a.g.length){if(dr(a)||dr(b))throw Error("slowDivide_ only works with positive integers.");for(var e=cr,t=b;0>=t.X(a);)e=vr(e),t=vr(t);var n=wr(e,1),r=wr(t,1);for(t=wr(t,2),e=wr(e,2);!lr(t);){var o=r.add(t);0>=o.X(a)&&(n=n.add(e),r=o),t=wr(t,1),e=wr(e,1)}return b=pr(a,n.R(b)),new mr(n,b)}for(n=ar;0<=a.X(b);){for(e=Math.max(1,Math.floor(a.ea()/b.ea())),t=48>=(t=Math.ceil(Math.log(e)/Math.LN2))?1:Math.pow(2,t-48),o=(r=sr(e)).R(b);dr(o)||0<o.X(a);)o=(r=sr(e-=t)).R(b);lr(r)&&(r=cr),n=n.add(r),a=pr(a,o)}return new mr(n,a)}function vr(a){for(var b=a.g.length+1,e=[],t=0;t<b;t++)e[t]=a.D(t)<<1|a.D(t-1)>>>31;return new nr(e,a.h)}function wr(a,b){var e=b>>5;b%=32;for(var t=a.g.length-e,n=[],r=0;r<t;r++)n[r]=0<b?a.D(r+e)>>>b|a.D(r+e+1)<<32-b:a.D(r+e);return new nr(n,a.h)}(r=nr.prototype).ea=function(){if(dr(this))return-fr(this).ea();for(var a=0,b=1,e=0;e<this.g.length;e++){var t=this.D(e);a+=(0<=t?t:or+t)*b,b*=or}return a},r.toString=function(a){if(2>(a=a||10)||36<a)throw Error("radix out of range: "+a);if(lr(this))return"0";if(dr(this))return"-"+fr(this).toString(a);for(var b=sr(Math.pow(a,6)),e=this,t="";;){var n=yr(e,b).g,r=((0<(e=pr(e,n.R(b))).g.length?e.g[0]:e.h)>>>0).toString(a);if(lr(e=n))return r+t;for(;6>r.length;)r="0"+r;t=r+t}},r.D=function(a){return 0>a?0:a<this.g.length?this.g[a]:this.h},r.X=function(a){return dr(a=pr(this,a))?-1:lr(a)?0:1},r.abs=function(){return dr(this)?fr(this):this},r.add=function(a){for(var b=Math.max(this.g.length,a.g.length),e=[],t=0,n=0;n<=b;n++){var r=t+(65535&this.D(n))+(65535&a.D(n)),o=(r>>>16)+(this.D(n)>>>16)+(a.D(n)>>>16);t=o>>>16,r&=65535,o&=65535,e[n]=o<<16|r}return new nr(e,-2147483648&e[e.length-1]?-1:0)},r.R=function(a){if(lr(this)||lr(a))return ar;if(dr(this))return dr(a)?fr(this).R(fr(a)):fr(fr(this).R(a));if(dr(a))return fr(this.R(fr(a)));if(0>this.X(ur)&&0>a.X(ur))return sr(this.ea()*a.ea());for(var b=this.g.length+a.g.length,e=[],t=0;t<2*b;t++)e[t]=0;for(t=0;t<this.g.length;t++)for(var n=0;n<a.g.length;n++){var r=this.D(t)>>>16,o=65535&this.D(t),c=a.D(n)>>>16,h=65535&a.D(n);e[2*t+2*n]+=o*h,gr(e,2*t+2*n),e[2*t+2*n+1]+=r*h,gr(e,2*t+2*n+1),e[2*t+2*n+1]+=o*c,gr(e,2*t+2*n+1),e[2*t+2*n+2]+=r*c,gr(e,2*t+2*n+2)}for(t=0;t<b;t++)e[t]=e[2*t+1]<<16|e[2*t];for(t=b;t<2*b;t++)e[t]=0;return new nr(e,0)},r.gb=function(a){return yr(this,a).h},r.and=function(a){for(var b=Math.max(this.g.length,a.g.length),e=[],t=0;t<b;t++)e[t]=this.D(t)&a.D(t);return new nr(e,this.h&a.h)},r.or=function(a){for(var b=Math.max(this.g.length,a.g.length),e=[],t=0;t<b;t++)e[t]=this.D(t)|a.D(t);return new nr(e,this.h|a.h)},r.xor=function(a){for(var b=Math.max(this.g.length,a.g.length),e=[],t=0;t<b;t++)e[t]=this.D(t)^a.D(t);return new nr(e,this.h^a.h)},Wn.prototype.createWebChannel=Wn.prototype.g,Qn.prototype.send=Qn.prototype.u,Qn.prototype.open=Qn.prototype.m,Qn.prototype.close=Qn.prototype.close,Ye.NO_ERROR=0,Ye.TIMEOUT=8,Ye.HTTP_ERROR=6,Ze.COMPLETE="complete",nt.EventType=st,st.OPEN="a",st.CLOSE="b",st.ERROR="c",st.MESSAGE="d",ve.prototype.listen=ve.prototype.O,gn.prototype.listenOnce=gn.prototype.P,gn.prototype.getLastError=gn.prototype.Sa,gn.prototype.getLastErrorCode=gn.prototype.Ia,gn.prototype.getStatus=gn.prototype.da,gn.prototype.getResponseJson=gn.prototype.Wa,gn.prototype.getResponseText=gn.prototype.ja,gn.prototype.send=gn.prototype.ha,gn.prototype.setWithCredentials=gn.prototype.Oa,Zn.prototype.digest=Zn.prototype.l,Zn.prototype.reset=Zn.prototype.reset,Zn.prototype.update=Zn.prototype.j,nr.prototype.add=nr.prototype.add,nr.prototype.multiply=nr.prototype.R,nr.prototype.modulo=nr.prototype.gb,nr.prototype.compare=nr.prototype.X,nr.prototype.toNumber=nr.prototype.ea,nr.prototype.toString=nr.prototype.toString,nr.prototype.getBits=nr.prototype.D,nr.fromNumber=sr,nr.fromString=function e(a,b){if(0==a.length)throw Error("number format error: empty string");if(2>(b=b||10)||36<b)throw Error("radix out of range: "+b);if("-"==a.charAt(0))return fr(e(a.substring(1),b));if(0<=a.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=sr(Math.pow(b,8)),n=ar,r=0;r<a.length;r+=8){var o=Math.min(8,a.length-r),c=parseInt(a.substring(r,r+o),b);8>o?(o=sr(Math.pow(b,o)),n=n.R(o).add(sr(c))):n=(n=n.R(t)).add(sr(c))}return n};var _r=c.createWebChannelTransport=function(){return new Wn},Tr=c.getStatEventTarget=function(){return $e()},Er=c.ErrorCode=Ye,Ir=c.EventType=Ze,Sr=c.Event=Ke,Cr=c.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},kr=(c.FetchXmlHttpFactory=cn,c.WebChannel=nt),Ar=c.XhrIo=gn,Nr=c.Md5=Zn,Rr=c.Integer=nr}).call(this,n(46))}}]);